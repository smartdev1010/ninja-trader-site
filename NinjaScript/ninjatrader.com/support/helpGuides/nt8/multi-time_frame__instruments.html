<!DOCTYPE html>
<html>
  
<!-- Mirrored from ninjatrader.com/support/helpGuides/nt8/multi-time_frame__instruments.htm by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 26 Jan 2023 19:55:40 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <title>NinjaScript &gt; Educational Resources &gt; Multi-Time Frame &amp; Instruments</title>
    <meta name="generator" content="Help &amp; Manual" />
    <meta name="keywords" content="" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link type="text/css" href="default.css" rel="stylesheet" />
    <link type="text/css" href="custom.css" rel="stylesheet">
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="nt_custom.js"></script>
    <style TYPE="text/css" media="screen">
    html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: #FFFFFF;
    line-height: 1.15
    }
    
    div#printheader {
    display: none
    }
    #idheader {
    width: 100%;
    height: auto;
    padding: 0;
    margin: 0
    }
    #idcontent {
    position: relative
    }
    #callout-table, #overview-table {
    display: block;
    position: relative;
    top: 0;
    left: 0
    }
    #callout-icon {
    display: block;
    position: absolute;
    top: -11px;
    left: -11px
    }
    #callout-icon-flag {
    display: block;
    position: absolute;
    top: -11px;
    left: -8px
    }
    #callout-table a {
    text-decoration: none;
    color: blue
    }
    #callout-table a:visited {
    text-decoration: none;
    color: blue
    }
    #overview-table a {
    text-decoration: none;
    color: black
    }
    #overview-table a:visited {
    text-decoration: none;
    color: black
    }
    #callout-table a:hover, #overview-table a:hover {
    text-decoration: underline
    }
    #switchtoggles {
    text-align: right;
    padding: 0 5px 0 0;
    font-size: 90%
    }
    p.help-url {
    margin: 20px 0 5px 0;
    text-align: center;
    font-size: 80%;
    text-decoration: none
    }
    .sync-toc {
    color: #ffffff;
    font-size: 8pt;
    font-weight: bold;
    display: none
    }
    .sync-toc a {
    color: #ffffff;
    text-decoration: none;
    font-weight: bold
    }
    .sync-toc a:visited {
    color: #ffffff
    }
    .sync-toc a:hover {
    text-decoration: underline
    }
    .p_ToggleHeading:active {
    box-shadow: 0px 0px 4px #9ecaed
    }                    
    .Needs {
      border-color: #008000 !important;
      background-color: #f3f9f4;
    }
    .Under {
      border-color: #ffcc00 !important;
      background-color: #fffdf6;
    }
    </style>
    <noscript>
    <style type="text/css">
    html, body { overflow: auto; }
    </style>
    </noscript>
    <style type="text/css" media="print">
    span.f_Heading1 { color: black; }
    #idheader, #printheader img { display:none; }
    #printheader { display: block; margin-top: 20px; }
    #idcontent { margin-top: 10px; position:relative }
    </style>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="helpman_settings.js"></script>
    <script type="text/javascript" src="helpman_topicinit.js"></script>
    <script type="text/javascript" src="nsh.js"></script>
    
    
    
  
   <script type="text/javascript">
     HMSyncTOC("NT%20HelpGuide%20English.html", "multi-time_frame__instruments.html");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
  <body>
    
    
    
    <div id="printheader"><p class="p_HeadingTopic"><span class="f_HeadingTopic">Multi-Time Frame &amp; Instruments</span></p>
</div>
    <div id="idheader">
      <div id="idheaderbg">
        <table style="width:100%;border:none;margin:0px;background:#A41E22" cellspacing="0" cellpadding="0">
          <tr valign="bottom">
            <td align="left" valign="bottom" class="topichead">
              <p class="sync-toc">&lt;&lt; <a rel="nofollow" href="NT%20HelpGuide%20Englishcf1c.html?multi-time_frame__instruments.htm" target="_top">Click to Display Table of Contents</a> &gt;&gt;</p>
              <p class="crumbs" id="idnav"><b>Navigation:</b>&nbsp;
                
              <a href="ninjascript.html">NinjaScript</a> &gt; <a href="educational_resources.html">Educational Resources</a>&nbsp;&gt;</p>
              <p class="p_HeadingTopic"><span class="f_HeadingTopic">Multi-Time Frame &amp; Instruments</span></p>

            </td>
            <td align="right" width="120" valign="middle" class="topichead" id="idnav">
              
              <a href="multi-threading.html"><img name="prev" src="leftArrow.png" border=0 alt="Previous page"></a>
              
              <a href="educational_resources.html"><img name=main src="upArrow.png" border=0 alt="Return to chapter overview"></a>
              <a href="understanding_the_lifecycle_of.html"><img name=next src="rightArrow.png" border=0 alt="Next page"></a>
              
            </td>
          </tr>
        </table>
<!-- PM review header         
        <div id="status" class="" style="margin-bottom: 0px; min-height: 25px;font-size: small; border-bottom: solid 3px;  padding: 5px;">
          <b></b>: <span id="explain"></span>
        </div>
-->        
        <!-- The following code displays Expand All/Collapse All links  below the header in topics containing toggles -->
        
        <p id="switchtoggles"><a href="javascript:HMToggleExpandAll(!HMAnyToggleOpen())" title="Click to open/close expanding sections">Show/Hide Hidden Text</a></p>
        
      </div>
    </div>
    
    <div id="idcontent">
      <div id="innerdiv">
        <!-- Ask Internet Explorer 6.users to update their obsolete and dangerous browser -->
        <!--[if lt IE 7]><div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;'><a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0000_us.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." /></a></div><![endif]-->
        
        <!--ZOOMRESTART-->
        <h2 class="p_Heading2"><span class="f_Heading2">Multi-Series Scripting Overview</span></h2>
<p class="p_Normal">NinjaScript supports multiple time frames and instruments in a single script. This is possible because you can add additional Bars objects to indicators or strategies, in addition to the primary Bars object to which they are applied. A Bars object represents all of the bars of data on a chart. For example, if you had a MSFT 1 minute chart with 200 bars on it, the 200 bars represent one Bars object. In addition to adding Bars objects for reference or for use with indicator methods, you can execute trades across all the different instruments in a script. There is extreme flexibility in the NinjaScript model that NinjaTrader uses for multiple-bars scripts, so it is very important that you understand how it all works before you incorporate additional Bars objects in a script. An important fact to understand is that NinjaScript is truly event driven; every Bars object in a script will call the <a href="onbarupdate.html" class="topiclink">OnBarUpdate()</a> method. The significance of this will become evident throughout this page.</p>
<p class="p_Normal">&nbsp;</p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table class="Note" >
<tr class="Note">
<td class="Note"><p class="p_Normal"><span style="font-weight: bold;">Note</span>: &nbsp;If using <a href="onmarketdata.html" class="topiclink">OnMarketData()</a>, a subscription will be created on all bars series added in your indicator or strategy strategy (even if the instrument is the same). &nbsp;The market data subscription behavior occurs both in real-time and during <a href="developing_for__tick_replay.html" class="topiclink">TickReplay</a> historical</p>
</td>
</tr>
</table>
</div>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">It is also important that you understand the following method and properties:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span><a href="adddataseries.html" class="topiclink">AddDataSeries()</a></p><p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span><a href="barsarray.html" class="topiclink">BarsArray</a></p><p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span><a href="barsinprogress.html" class="topiclink">BarsInProgress</a></p><p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span><a href="currentbars.html" class="topiclink">CurrentBars</a></p><p class="p_Normal">&nbsp;</p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table class="Note" >
<tr class="Note">
<td class="Note"><p class="p_Normal"><span style="font-weight: bold;">Note</span>: &nbsp;As we move through this section, the term &quot;Primary Bars&quot; will be used and for the purpose of clarification, this will always refer to the first Bars object loaded into a script. For example, if you apply a script on MSFT 1 minute chart, the primary Bars would be MSFT 1 minute data set.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><span style="font-weight: bold;">This section is written in sequential fashion. Example code is re-used and built upon from sub section to sub section.</span></p>
</td>
</tr>
</table>
</div>
<p class="p_ToggleHeading"><img id="WorkingWithMultiTimeFrameObjects_ICON" class="dropdown-toggle-icon" alt="tog_minus" width="16" height="16" style="margin:0;width:16px;height:16px;border:none" src="tog_minus.gif"/> &nbsp; &nbsp; &nbsp; &nbsp;<span class="f_ToggleHeading"><a class="dropdown-toggle" style="font-style: normal; font-weight: normal; color: #000000; background-color: transparent; text-decoration: none;" href="javascript:HMToggle('toggle','WorkingWithMultiTimeFrameObjects','WorkingWithMultiTimeFrameObjects_ICON')">Working&nbsp;With&nbsp;Multi-Time&nbsp;Frame&nbsp;Objects</a></span></p>
<div id="WorkingWithMultiTimeFrameObjects" class="dropdown-toggle-body" style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table class="Toggle" >
<tr class="Toggle">
<td class="Toggle" style="background-color:#FFFFFF;"><h2 class="p_Heading2"><span class="f_Heading2">Data processing sequence</span></h2>
<p class="p_Normal">Understanding the sequence in which bars series process and the granularity provided by market data vendors is essential for efficient multi-series development. Let’s assume we have two series (primary and secondary) in our script, which is representing the same instrument, yet different intervals. &nbsp;During historical data processing, NinjaTrader updates the two series <span style="font-style: italic;">strictly</span> according to their timestamps, calling the primary bar series of the corresponding timestamps first, and then calling the secondary series.</p>
<p class="p_Normal">&nbsp;</p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table class="Note" >
<tr class="Note">
<td class="Note"><p class="p_Normal"><span style="font-weight: bold;">Note</span>: &nbsp;Historical bars are processed according to their timestamps with the primary bars first, followed by the secondary, which is <span style="font-weight: bold;">NOT</span> guaranteed to be the same sequence that these events occurred in real-time. &nbsp;If your development requires ticks to process in the same sequence historically as well as in real-time, you will need to enable <a href="developing_for__tick_replay.html" class="topiclink">Tick Replay</a> (utilizes more PC resources).</p>
</td>
</tr>
</table>
</div>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><span class="f_Heading2">Shared Timestamps</span></p>
<p class="p_Normal">In circumstances where multiple bars share the same exact timestamps, your primary bars series will <span style="font-style: italic;">always</span> be processed first, followed by the secondary bars series (regardless of the period value used). Consequently, if you were looking to obtain a value from the secondary bars series, it would <span style="font-weight: bold;">ONLY</span> be available <span style="font-style: italic;">after</span> the primary series has been processed for the same timestamps. For example, consider a news event or a fast moving market with an influx of ticks (session begin/session end). This activity will yield a wider range of bars than usual and the probability of those bars sharing the same timestamps increases. If such a succession of bars with the same timestamps is processed, the primary bars would be processed first and then the secondary bars during this period. &nbsp;</p>
<p class="p_Normal">&nbsp;</p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table class="Tip" >
<tr class="Tip">
<td class="Tip"><p class="p_Normal"><span style="font-weight: bold;">Tip</span>: While the following behavior applies to all period types, the effects are amplified on smaller time frames. &nbsp;If you plan on using a high-resolution (e.g., 1-second, 10-tick, etc), please make sure to thoroughly read and understand the material below when working with these additional series. &nbsp;It is also important to keep in mind that the granularity of the timestamps will dictate how accurately NinjaTrader can synchronize the bars in historical processing. &nbsp; The available level of granularity will be dependent upon which <a href="data_by_provider.html" class="topiclink">data provider</a> you use with NinjaTrader.</p>
</td>
</tr>
</table>
</div>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Let’s look at an illustration of how the multi-time frame bar processing sequence can be understood. &nbsp;Assume our primary series is a 5-tick bar series, and our secondary series is a 1-tick bar series. &nbsp;The time of day is near the session close, so a rapid sequence of bars is generated. </p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">In the figure below, the 1st group of bars (colored orange), and the 4th group of bars (colored purple) process in an exact logical sequence (i.e., a single primary bar update, followed by five secondary series updates). &nbsp;This is because each bar in these groups have <span style="font-style: italic;">unique timestamps</span> and NinjaTrader can synchronize those bars logically in the exact time sequence each series updated. &nbsp;However, all of the bars marked with <span style="color: #ff0000;">red text</span> share the<span style="font-style: italic;"> same exact timestamps</span> down to the millisecond (<span style="color: #ff0000;">14:59:00:480</span>). &nbsp;Since there were six ticks in sequence with the shared timestamps, this range of ticks expands two of the primary bars (colored green and blue). &nbsp;As a result, the primary bar #3 appears to update earlier when compared to the secondary series. &nbsp;In reality, both bars series are incrementing in their exact sequence according to the timestamps of each series.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><img alt="same_timestamp_bars" width="1111" height="310" style="margin:0;width:1111px;height:310px;border:none" src="same_timestamp_bars.png"/></p>
<p class="p_Normal"><span class="f_ImageCaption">Figure 1. &nbsp;Bar processing &nbsp;with shared timestamps</span></p>
<p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_ImageCaption" style="display:inline-block;width:20px;margin-left:-20px">1.</span><span class="f_ImageCaption">Timestamps of primary series (hour, minute, second, millisecond)</span></p><p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_ImageCaption" style="display:inline-block;width:20px;margin-left:-20px">2.</span><span class="f_ImageCaption">Current bars numbered in series representing 5-tick primary series</span></p><p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_ImageCaption" style="display:inline-block;width:20px;margin-left:-20px">3.</span><span class="f_ImageCaption">Current bars numbered in series representing 1-tick secondary series</span></p><p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_ImageCaption" style="display:inline-block;width:20px;margin-left:-20px">4.</span><span class="f_ImageCaption">Millisecond time stamps of secondary series</span></p><p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_ImageCaption" style="display:inline-block;width:20px;margin-left:-20px">5.</span><span class="f_ImageCaption">A sequence of bars sharing the same time stamps</span></p></td>
</tr>
</table>
</div>
<p class="p_ToggleHeading"><img id="AddingAdditionalBarsObjectToninjascript_ICON" class="dropdown-toggle-icon" alt="tog_minus" width="16" height="16" style="margin:0;width:16px;height:16px;border:none" src="tog_minus.gif"/> &nbsp; &nbsp; &nbsp; &nbsp;<span class="f_ToggleHeading"><a class="dropdown-toggle" style="font-style: normal; font-weight: normal; color: #000000; background-color: transparent; text-decoration: none;" href="javascript:HMToggle('toggle','AddingAdditionalBarsObjectToninjascript','AddingAdditionalBarsObjectToninjascript_ICON')">Adding&nbsp;Additional&nbsp;Bars&nbsp;Objects&nbsp;to&nbsp;NinjaScript</a></span></p>
<div id="AddingAdditionalBarsObjectToninjascript" class="dropdown-toggle-body" style="text-align: left; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 32px;"><table class="Toggle" >
<tr class="Toggle">
<td class="Toggle" style="background-color:#FFFFFF;"><p class="p_Normal">Additional Bars are added to a script via the <a href="adddataseries.html" class="topiclink">AddDataSeries()</a> method in the <a href="onstatechange.html" class="topiclink">OnStateChange()</a> method when the <a href="state.html" class="topiclink">State</a> has reached <span style="font-weight: bold;">State.Configure</span>. When a Bars object is added to a script, it is also added to the <a href="barsarray.html" class="topiclink">BarsArray</a> array.  <span style="font-weight: bold;">BarsArray</span> functions like a container in the script that holds all Bars objects added to the script. As a Bars object is added to the script, it's added to <span style="font-weight: bold;">BarsArray</span> and given an index number so we can retrieve this Bars object later. </p>
<p class="p_Normal">&nbsp;</p>
<div style="text-align: left; text-indent: 0; padding: 0 0 0 0; margin: 0 0 0 0;"><table class="Warning" >
<tr class="Warning">
<td class="Warning"><p class="p_Normal"><span style="font-weight: bold;">Warning: &nbsp;</span></p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>This method should <span style="font-weight: bold;">ONLY</span> be called from the <a href="onstatechange.html" class="topiclink">OnStateChange() </a>method during <span style="font-weight: bold;">State.Configure</span></p><p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>Arguments supplied to <span style="font-weight: bold;">AddDataSeries()</span> should be hardcoded and <span style="font-weight: bold;">NOT</span> dependent on run-time variables which cannot be reliably obtained during <a href="state.html" class="topiclink">State.Configure</a> (e.g., <a href="instrument.html" class="topiclink">Instrument</a>, <a href="bars.html" class="topiclink">Bars</a>, or user input). &nbsp;Attempting to add a data series dynamically is <span style="font-weight: bold;">NOT</span> guaranteed and therefore should be avoided. &nbsp;Trying to load bars dynamically may result in an error similar to: <span class="f_ExampleText">Unable to load bars series. Your NinjaScript may be trying to use an additional data series dynamically in an unsupported manner.</span></p><p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>When instantiating indicators in a Multi-Series script in <a href="onstatechange.html" class="topiclink">OnStateChange</a>, the input any hosted indicator is running on should be explicitly stated (since a specific <a href="barsinprogress.html" class="topiclink">BarsInProgress</a> is not guaranteed)</p></td>
</tr>
</table>
</div>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">For the purpose of demonstration, let's assume that a MSFT 1 minute bar is our primary Bars object (set when the script is applied to a 1 minute MSFT chart) and that the OnStateChange() method is adding a 3 minute Bars object of MSFT, then adding a 1 minute Bars object of AAPL, for a total of 3 unique Bars objects.</p>
<p class="p_Normal">&nbsp;</p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table id="Code1" class="NSExample" >
<thead>
<tr class="NSExample">
<th class="NSExample" style="vertical-align:middle;"><h2 class="p_Heading2"><img alt="ns" width="20" height="20" style="margin:0;width:20px;height:20px;border:none" src="ns.png"/></h2>
</th>
</tr>
</thead>
<tbody>
<tr class="NSExample">
<td class="NSExample"><p class="p_CodeExample"><span class="f_CodeExample" style="color: #0000ff;">protected</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">override</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">OnStateChange()</span><br />
<span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(State</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">==</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">State.SetDefaults)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample">{</span><span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="f_CodeExample">Name</span><span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #800000;">&quot;Multi-Time Frame &amp; Instruments Example&quot;</span><span class="f_CodeExample">;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample" style="color: #0000ff;">else</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(State</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">==</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">State.Configure)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample">{</span><span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp;  </span><span class="f_CodeExample">AddDataSeries(BarsPeriodType.Minute,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">3</span><span class="f_CodeExample">);</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp;  </span><span class="f_CodeExample">AddDataSeries(</span><span class="f_CodeExample" style="color: #800000;">&quot;AAPL&quot;</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">BarsPeriodType.Minute,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">1</span><span class="f_CodeExample">);</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">}</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table class="Note" >
<tr class="Note">
<td class="Note"><p class="p_Normal"><span style="font-weight: bold;">Note</span>: To maximize data loading performance, any NinjaScript object (indicator or strategy as host) which references a multi-series indicator which calls AddDataSeries must include it's own calls to AddDataSeries(). For example, if the code above was included in an indicator, and that indicator was referenced in a &nbsp;NinjaScript strategy, then the hosting strategy will need to include the same calls to AddDataSeries(). When the strategy adds the additional Bars objects, the calls to AddDataSeries() within the indicator will be ignored. If the Bars objects are not added by the strategy in such cases, and error will be thrown in the Log tab of the Control Center that would read - &quot;A hosted indicator tried to load additional data. All data must first be loaded by the hosting NinjaScript in its configure state.&quot;</p>
</td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<p class="p_ToggleHeading"><img id="CreatingSeriesObjects_ICON" class="dropdown-toggle-icon" alt="tog_minus" width="16" height="16" style="margin:0;width:16px;height:16px;border:none" src="tog_minus.gif"/> &nbsp; &nbsp; &nbsp; &nbsp;<span class="f_ToggleHeading"><a class="dropdown-toggle" style="font-style: normal; font-weight: normal; color: #000000; background-color: transparent; text-decoration: none;" href="javascript:HMToggle('toggle','CreatingSeriesObjects','CreatingSeriesObjects_ICON')">Creating&nbsp;Series&lt;T&gt;&nbsp;Objects</a></span></p>
<div id="CreatingSeriesObjects" class="dropdown-toggle-body" style="text-align: left; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 32px;"><table class="Toggle" >
<tr class="Toggle">
<td class="Toggle" style="background-color:#FFFFFF;"><h2 class="p_Heading2"><span class="f_Heading2">Series&lt;T&gt; Objects</span></h2>
<p class="p_Normal"><a href="seriest.html" class="topiclink">Series&lt;T&gt;</a> is the base class for <a href="priceseries.html" class="topiclink">PriceSeries</a>, <a href="timeseries.html" class="topiclink">TimeSeries</a>, and <a href="volumeseries.html" class="topiclink">VolumeSeries</a>. Rather than using one of these pre-defined derived classes, you can create your own Series&lt;T&gt; collection to hold any Type that you choose. The advantage that Series&lt;T&gt; has over other collections is that it can be quickly initialized to contain a number of index slots equal to the number of bars in one of the Bars objects on the chart, with each index slot corresponding to a specific bar.</p>
<h2 class="p_Heading2"><span class="f_Heading2">&nbsp;</span></h2>
<h2 class="p_Heading2"><span class="f_Heading2">Initializing a Series&lt;T&gt; with BarsArray</span></h2>
<p class="p_Normal">A Series&lt;T&gt; can be constructed by passing in a specific index of BarsArray. Initializing a Series&lt;T&gt; this way produces an empty Series&lt;T&gt; container holding the same number of index slots as the BarsArray that was passed in as an argument. For example, assuming that BarsArray[1] holds 500 bars, the code below will create an empty Series&lt;T&gt; with 500 index slots:</p>
<p class="p_Normal">&nbsp;</p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table id="Code1" class="NSExample" >
<thead>
<tr class="NSExample">
<th class="NSExample" style="vertical-align:middle;"><h2 class="p_Heading2"><img alt="ns" width="20" height="20" style="margin:0;width:20px;height:20px;border:none" src="ns.png"/><span class="f_ImageCaption"> </span><span class="f_NSexamplesheading">Initializing Series&lt;T&gt; with BarsArray</span></h2>
</th>
</tr>
</thead>
<tbody>
<tr class="NSExample">
<td class="NSExample"><p class="p_CodeExample"><span class="f_CodeExample" style="color: #0000ff;">private</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">Series&lt;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&gt;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">myEmptyIndexedSeries;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #008000;">// Define a Series&lt;T&gt; objectvariable.</span><br />
<span class="f_CodeExample" style="color: #008000;">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #008000;">// Initialize the Series object to have the same number of index slots as BarsArray[1]</span><br />
<span class="f_CodeExample" style="color: #0000ff;">protected</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">override</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">OnStateChange()</span><br />
<span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(State</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">==</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">State.DataLoaded)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp;  </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// Passing in BarsArray[1] as an argument results in an empty Series with an identical number of index slots</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">myEmptyIndexedSeries</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">new</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">Series&lt;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&gt;(BarsArray[</span><span class="f_CodeExample" style="color: #ff6600;">1</span><span class="f_CodeExample">]);</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp;  </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">}</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_Normal">This method of initializing a Series&lt;T&gt; can be especially useful when you wish to store user-defined information related to each bar in a Bars object on the chart. This process ensures that index slots are available for every bar on the chart right away.</p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<h2 class="p_Heading2"><span class="f_Heading2">Initializing a Series&lt;T&gt; with an Indicator Method</span></h2>
<p class="p_Normal">Passing in an indicator method as an argument when instantiating a Series&lt;T&gt; object provides an alternative to the process outlined above. Because indicator methods already contain Series objects synced to the bars on a chart, they can be used to inform the constructor of Series&lt;T&gt; of how many index slots to create.</p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table id="Code1" class="NSExample" >
<thead>
<tr class="NSExample">
<th class="NSExample" style="vertical-align:middle;"><h2 class="p_Heading2"><img alt="ns" width="20" height="20" style="margin:0;width:20px;height:20px;border:none" src="ns.png"/><span class="f_ImageCaption"> </span><span class="f_NSexamplesheading">Initializing Series&lt;T&gt; with an Indicator Method</span></h2>
</th>
</tr>
</thead>
<tbody>
<tr class="NSExample">
<td class="NSExample"><p class="p_CodeExample"><span class="f_CodeExample" style="color: #008000;">// Declare two Series objects</span><br />
<span class="f_CodeExample" style="color: #0000ff;">private</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">Series&lt;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&gt;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">primarySeries;</span><br />
<span class="f_CodeExample" style="color: #0000ff;">private</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">Series&lt;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&gt;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">secondarySeries;</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #0000ff;">protected</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">override</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">OnStateChange()</span><br />
<span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(State</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">==</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">State.Configure)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp;  </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// Adds a secondary bar object to the strategy.</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">AddDataSeries(BarsPeriodType.Minute,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">5</span><span class="f_CodeExample">);</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp;  </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">else</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(State</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">==</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">State.DataLoaded)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp;  </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// Syncs a Series object to the primary bar object</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">primarySeries</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">new</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">Series&lt;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&gt;(</span><span class="f_CodeExample" style="color: #0000ff;">this</span><span class="f_CodeExample">);</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">/* Syncs another Series object to the secondary bar object.</span><br />
<span class="f_CodeExample" style="color: #008000;"> &nbsp; &nbsp; &nbsp; &nbsp;We use an arbitrary indicator overloaded with an ISeries&lt;double&gt; input to achieve the sync.</span><br />
<span class="f_CodeExample" style="color: #008000;"> &nbsp; &nbsp; &nbsp; &nbsp;The indicator can be any indicator. The Series&lt;double&gt; will be synced to whatever the</span><br />
<span class="f_CodeExample" style="color: #008000;"> &nbsp; &nbsp; &nbsp; &nbsp;BarsArray[] is provided.*/</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">secondarySeries</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">new</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">Series&lt;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&gt;(SMA(BarsArray[</span><span class="f_CodeExample" style="color: #ff6600;">1</span><span class="f_CodeExample">],</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">50</span><span class="f_CodeExample">));</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// Stop-loss orders are placed 5 ticks below average entry price</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">SetStopLoss(CalculationMode.Ticks,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">5</span><span class="f_CodeExample">);</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// Profit target orders are placed 10 ticks above average entry price</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">SetProfitTarget(CalculationMode.Ticks,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">10</span><span class="f_CodeExample">);</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp;  </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">}</span></p>
</td>
</tr>
</tbody>
</table>
</div>
</td>
</tr>
</table>
</div>
<p class="p_ToggleHeading"><img id="HowBarsDataIsReferenced_ICON" class="dropdown-toggle-icon" alt="tog_minus" width="16" height="16" style="margin:0;width:16px;height:16px;border:none" src="tog_minus.gif"/> &nbsp; &nbsp; &nbsp; &nbsp;<span class="f_ToggleHeading"><a class="dropdown-toggle" style="font-style: normal; font-weight: normal; color: #000000; background-color: transparent; text-decoration: none;" href="javascript:HMToggle('toggle','HowBarsDataIsReferenced','HowBarsDataIsReferenced_ICON')">How&nbsp;Bars&nbsp;Data&nbsp;is&nbsp;Referenced</a></span></p>
<div id="HowBarsDataIsReferenced" class="dropdown-toggle-body" style="text-align: left; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 32px;"><table class="Toggle" >
<tr class="Toggle">
<td class="Toggle" style="background-color:#FFFFFF;"><p class="p_Normal">Understanding how multi-time frame bars are processed and which OHLCV data is referenced is critical.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Figure 1 below demonstrates the concept of bar processing on historical data or in real-time when the <a href="calculate.html" class="topiclink">Calculate</a> property is set to<span style="font-weight: bold;"> Calculate.OnBarClose</span>. The 1 minute bars in yellow will only know the OHLCV of the 3 minute bar in yellow. The 1 minute bars in cyan will only know the OHLCV data of the 3 minute bar in cyan. Take a look at &quot;Bar #5,&quot; which is the fifth one minute bar. If you wanted to know the current high value for the 3-minute time frame, you would get the value of the first 3 minute bar since this is the last &quot;closed&quot; bar. The second 3 minute bar (cyan) would not be known at that time.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><img alt="Tips_3" width="287" height="184" style="margin:0;width:287px;height:184px;border:none" src="tips_3.png"/></p>
<p class="p_Normal"><span class="f_ImageCaption">Figure 1. &nbsp;Bar processing on historical data using Calculate.OnBarClose</span></p>
<p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_ImageCaption" style="display:inline-block;width:20px;margin-left:-20px">1.</span><span class="f_ImageCaption">Primary 1-minute bar series</span></p><p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_ImageCaption" style="display:inline-block;width:20px;margin-left:-20px">2.</span><span class="f_ImageCaption">Secondary 3-minute bar series</span></p><p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_ImageCaption" style="display:inline-block;width:20px;margin-left:-20px">3.</span><span class="f_ImageCaption">Bar #5</span></p><p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Contrast the above image and concept with the image below, which demonstrates bar processing in real-time when the <span style="font-weight: bold;">Calculate</span> property is set to <span style="font-weight: bold;">Calculate.OnEachTick</span> &nbsp;(tick by tick processing) or <span style="font-weight: bold;">Calculate.OnPriceChange (</span>processing by change in price). The 1 minute bars in yellow will know the current OHLCV of the 3 minute bar in yellow (second 3 minute bar) which is still in formation and has not yet closed.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><img alt="Tips_4" width="287" height="184" style="margin:0;width:287px;height:184px;border:none" src="tips_4.png"/></p>
<p class="p_Normal"><span class="f_ImageCaption">Figure 2. &nbsp;Bar processing in real-time using Calculate.OnEachTick or Calculate.OnPriceChange</span></p>
<p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_ImageCaption" style="display:inline-block;width:20px;margin-left:-20px">1.</span><span class="f_ImageCaption">Primary 1-minute bar series</span></p><p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_ImageCaption" style="display:inline-block;width:20px;margin-left:-20px">2.</span><span class="f_ImageCaption">Secondary 3-minute bar series</span></p><p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_ImageCaption" style="display:inline-block;width:20px;margin-left:-20px">3.</span><span class="f_ImageCaption">Bar #5</span></p><p class="p_Normal">&nbsp;</p>
<p class="p_Normal">If you have a multi-time frame script in real-time, and it is processing tick by tick instead of on the close of each bar, understand that the OHLCV data you access in real-time is different than on historical data.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Below is another example to illustrate this point:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Your script has complex logic that changes the bar color on the chart. You are running tick by tick, as per the above &quot;Figure 2&quot; image, the 5th 1 minute bar is looking at OHLCV data from the second 3 minute bar. Your script changes the fifth 1 minute bar color to green. In the future, you reload your script into the chart and the fifth 1 minute bar is now a historical bar. As per Figure 1 above, the fifth 1 minute bar now references the OHLCV data of the first 3 minute bar (instead of the 2nd 3 minute bar as per Figure 2) and as a result, your script logic condition for coloring the bar green is no longer valid. The result is that now your chart looks different.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Special considerations for session boundaries :</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Bars are not considered closed until the first tick of the following bar comes in (see also &quot;True Event Driven OnBarUpdate&quot; below). As a consequence, if the above series 2 cyan bar represents the final bar of a session, and this bar is referenced from the matching series 1 cyan bar, or anywhere after that, the data from the close of the bar (the beginning of the next session) will be referenced. If you plan on using multiple session templates, you will need to handle the final bar of a trading day case explicitly (for example, using a <a href="sessioniterator.html" class="topiclink">Session Iterator</a> and the <a href="prior_day_ohlc.html" class="topiclink">PriorDayOHLC</a>) if you would like to reference data from the end of the previous trading day instead of the beginning of the current trading day.</p>
</td>
</tr>
</table>
</div>
<p class="p_ToggleHeading"><img id="UsingBarsObjectsAsInputToIndicatorMethods_ICON" class="dropdown-toggle-icon" alt="tog_minus" width="16" height="16" style="margin:0;width:16px;height:16px;border:none" src="tog_minus.gif"/> &nbsp; &nbsp; &nbsp; &nbsp;<span class="f_ToggleHeading"><a class="dropdown-toggle" style="font-style: normal; font-weight: normal; color: #000000; background-color: transparent; text-decoration: none;" href="javascript:HMToggle('toggle','UsingBarsObjectsAsInputToIndicatorMethods','UsingBarsObjectsAsInputToIndicatorMethods_ICON')">Using&nbsp;Bars&nbsp;Objects&nbsp;as&nbsp;Input&nbsp;to&nbsp;Indicator&nbsp;Methods</a></span></p>
<div id="UsingBarsObjectsAsInputToIndicatorMethods" class="dropdown-toggle-body" style="text-align: left; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 32px;"><table class="Toggle" >
<tr class="Toggle">
<td class="Toggle" style="background-color:#FFFFFF;"><p class="p_Normal">In the sub-section above, the concept of index values was introduced. This is a critical concept to understand since it is used consistently when working with multi-Bars script.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Let's demonstrate this concept:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Carrying on from the example above, our primary Bars is set from a MSFT 1 minute chart</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_ExampleText" style="margin: 0 0 0 24px;"><span class="f_ExampleText">MSFT 1 minute Bars is given an index value of 0 in BarsArray</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">In the OnStateChange() method we added a MSFT 3 minute Bars object and an AAPL 1 minute Bars object to the script</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_ExampleText" style="margin: 0 0 0 24px;"><span class="f_ExampleText">MSFT 3 minute Bars is given an index value of 1 in BarsArray</span></p>
<p class="p_ExampleText" style="margin: 0 0 0 24px;"><span class="f_ExampleText">AAPL 1 minute Bars is given an index value of 2 in BarsArray</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Incremental index values are given to Bars objects as they are added to a script. If there are 10 Bars objects in a script, then you will have index values ranging from 0 to 9.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Our script now has 3 Bars objects in the container <span style="font-weight: bold;">BarsArray</span>. From this point forward, we can ask this container to give us the Bars object we want to work with by providing the index value. The syntax for this is:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"> &nbsp; &nbsp; <span style="font-weight: bold; color: #808080;">BarsArray[index]</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">This allows us to get the correct Bars object and use it as input for an <a href="indicators.html" class="topiclink">indicator method</a>. For example:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"> &nbsp; &nbsp; <span style="font-weight: bold; color: #808080;">ADX(14)[0] &gt; 30 &amp;&amp; ADX(BarsArray[2], 14)[0] &gt; 30</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">The above expression in English would translate to:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_ExampleText"><span class="f_ExampleText"> &nbsp; &nbsp; If the 14 period ADX of MSFT 1 minute is greater than 30 and the 14 period ADX of AAPL 1 minute is greater than 30</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Before we can apply this concept, we need to ensure that our Bars objects actually contain bars that we can use to run calculations. This can be done by checking the <a href="currentbars.html" class="topiclink">CurrentBars</a> array, which returns the number of the current bar in each Bars object. Using this in conjunction with <a href="barsrequiredtoplot.html" class="topiclink">BarsRequiredToPlot</a> will ensure each Bars object has sufficient data before we begin processing.</p>
<p class="p_Normal">&nbsp;</p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table class="Note" >
<tr class="Note">
<td class="Note"><p class="p_Normal"><span style="font-weight: bold;">Note</span>: &nbsp;By default, the <span style="font-weight: bold;">CurrentBars</span> starting value will be -1 until all series have processed the first bar.</p>
</td>
</tr>
</table>
</div>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table id="Code1" class="NSExample" >
<thead>
<tr class="NSExample">
<th class="NSExample" style="vertical-align:middle;"><h2 class="p_Heading2"><img alt="ns" width="20" height="20" style="margin:0;width:20px;height:20px;border:none" src="ns.png"/></h2>
</th>
</tr>
</thead>
<tbody>
<tr class="NSExample">
<td class="NSExample"><p class="p_CodeExample"><span class="f_CodeExample" style="color: #0000ff;">protected</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">override</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">OnBarUpdate()</span><br />
<span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// Checks to ensure all Bars objects contain enough bars before beginning.</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// If this is a strategy, use BarsRequiredToTrade instead of BarsRequiredToPlot</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(CurrentBars[</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&lt;=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">BarsRequiredToPlot</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">||</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">CurrentBars[</span><span class="f_CodeExample" style="color: #ff6600;">1</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&lt;=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">BarsRequiredToPlot</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">||</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">CurrentBars[</span><span class="f_CodeExample" style="color: #ff6600;">2</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&lt;=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">BarsRequiredToPlot)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">;</span><br />
<span class="f_CodeExample">}</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Putting it all together now, the following example checks if the current CCI value for all Bars objects is above 200. You will notice that BarsInProgress is used. This is to check which Bars object is calling the OnBarUpdate() method. More on this later in this section.</p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table id="Code1" class="NSExample" >
<thead>
<tr class="NSExample">
<th class="NSExample" style="vertical-align:middle;"><h2 class="p_Heading2"><img alt="ns" width="20" height="20" style="margin:0;width:20px;height:20px;border:none" src="ns.png"/></h2>
</th>
</tr>
</thead>
<tbody>
<tr class="NSExample">
<td class="NSExample"><p class="p_CodeExample"><span class="f_CodeExample" style="color: #0000ff;">protected</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">override</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">OnBarUpdate()</span><br />
<span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// Checks to ensure all Bars objects contain enough bars before beginning</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// If this is a strategy, use BarsRequiredToTrade instead of BarsRequiredToPlot</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(CurrentBars[</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&lt;=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">BarsRequiredToPlot</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">||</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">CurrentBars[</span><span class="f_CodeExample" style="color: #ff6600;">1</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&lt;=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">BarsRequiredToPlot</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">||</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">CurrentBars[</span><span class="f_CodeExample" style="color: #ff6600;">2</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&lt;=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">BarsRequiredToPlot)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">;</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(BarsInProgress</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">==</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(CCI(</span><span class="f_CodeExample" style="color: #ff6600;">20</span><span class="f_CodeExample">)[</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&gt;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">200</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&amp;&amp;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">CCI(BarsArray[</span><span class="f_CodeExample" style="color: #ff6600;">1</span><span class="f_CodeExample">],</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">20</span><span class="f_CodeExample">)[</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&gt;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">200</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="f_CodeExample">&amp;&amp;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">CCI(BarsArray[</span><span class="f_CodeExample" style="color: #ff6600;">2</span><span class="f_CodeExample">],</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">20</span><span class="f_CodeExample">)[</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&gt;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">200</span><span class="f_CodeExample">)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// Do something</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">}</span></p>
</td>
</tr>
</tbody>
</table>
</div>
</td>
</tr>
</table>
</div>
<p class="p_ToggleHeading"><img id="TrueEventDrivenOnbarupdateMethod_ICON" class="dropdown-toggle-icon" alt="tog_minus" width="16" height="16" style="margin:0;width:16px;height:16px;border:none" src="tog_minus.gif"/> &nbsp; &nbsp; &nbsp; &nbsp;<span class="f_ToggleHeading"><a class="dropdown-toggle" style="font-style: normal; font-weight: normal; color: #000000; background-color: transparent; text-decoration: none;" href="javascript:HMToggle('toggle','TrueEventDrivenOnbarupdateMethod','TrueEventDrivenOnbarupdateMethod_ICON')">True&nbsp;Event&nbsp;Driven&nbsp;OnBarUpdate()&nbsp;Method</a></span></p>
<div id="TrueEventDrivenOnbarupdateMethod" class="dropdown-toggle-body" style="text-align: left; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 32px;"><table class="Toggle" >
<tr class="Toggle">
<td class="Toggle" style="background-color:#FFFFFF;"><p class="p_Normal">Since a NinjaScript script is truly event driven, the OnBarUpdate() method is called for every bar update event for each Bars object added to the script. This model maximizes flexibility. For example, you could have multiple trading systems combined into one strategy, each dependent on one another. For example, you could have a 1 minute MSFT Bars object and a 1 minute AAPL Bars object, process different trading rules on each Bars object and check to see if MSFT is long when AAPL trading logic is being processed.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">The <a href="barsinprogress.html" class="topiclink">BarsInProgress</a> property is used to identify which Bars object is calling the OnBarUpdate() method. This allows you to filter out the events that you are looking for.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Continuing our example above, let's take a closer look at what is happening. Remember, we have three Bars objects working in our script, a primary Bars MSFT 1 minute, an MSFT 3 minute, and an AAPL 1 minute.</p>
<p class="p_Normal">&nbsp;</p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table id="Code1" class="NSExample" >
<thead>
<tr class="NSExample">
<th class="NSExample" style="vertical-align:middle;"><h2 class="p_Heading2"><img alt="ns" width="20" height="20" style="margin:0;width:20px;height:20px;border:none" src="ns.png"/></h2>
</th>
</tr>
</thead>
<tbody>
<tr class="NSExample">
<td class="NSExample"><p class="p_CodeExample"><span class="f_CodeExample" style="color: #0000ff;">protected</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">override</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">OnBarUpdate()</span><br />
<span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// Checks to ensure all Bars objects contain enough bars before beginning</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// If this is a strategy, use BarsRequiredToTrade instead of BarsRequiredToPlot</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(CurrentBars[</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&lt;=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">BarsRequiredToPlot</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">||</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">CurrentBars[</span><span class="f_CodeExample" style="color: #ff6600;">1</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&lt;=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">BarsRequiredToPlot</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">||</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">CurrentBars[</span><span class="f_CodeExample" style="color: #ff6600;">2</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&lt;=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">BarsRequiredToPlot)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">;</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// Checks if OnBarUpdate() is called from an update on the primary Bars</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(BarsInProgress</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">==</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(Close[</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&gt;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">Open[</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">])</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// Do something</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// Checks if OnBarUpdate() is called from an update on MSFT 3 minute Bars</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(BarsInProgress</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">==</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">1</span><span class="f_CodeExample">)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(Close[</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&gt;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">Open[</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">])</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// Do something</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// Checks if OnBarUpdate() is called from an update on AAPL 1 minute Bars</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(BarsInProgress</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">==</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">2</span><span class="f_CodeExample">)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(Close[</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&gt;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">Open[</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">])</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// Do something</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">}</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_Normal">What is important to understand in the above sample code is that we have &quot;if&quot; branches that check to see what Bars object is calling the OnBarUpdate() method in order to process relevant trading logic. If we only wanted to process the events from the primary Bars we could add the following condition at the top of the OnBarUpdate() method:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><span style="font-weight: bold; color: #808080;"> &nbsp; &nbsp; if (BarsInProgress != 0) </span><br />
<span style="font-weight: bold; color: #808080;"> &nbsp; &nbsp; &nbsp; &nbsp; return;</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">What is also important to understand is the concept of context. When the OnBarUpdate() method is called, it will be called within the context of the calling Bars object. This means that if the primary Bars triggers the OnBarUpdate() method, all indicator methods and price data will point to that Bars object's data. Notice how the statement &quot;if (Close[0] &gt; Open[0]&quot; exists under each &quot;if&quot; branch in the code sample above. The values returned by Close[0] and Open[0] will be the close and open price values for the calling Bars object. So when the BarsInProgress == 0 (primary Bars) the close value returned is the close price of the MSFT 1 minute bar. When the BarsInProgress == 1 the close value returned is the close price of the MSFT 3 minute Bars object.</p>
<p class="p_Normal">&nbsp;</p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table class="Note" >
<tr class="Note">
<td class="Note"><p class="p_Normal"><span style="font-weight: bold;">Notes:</span></p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>A multi-series script only processes bar update events from the primary Bars (the series the script is applied to) and any additional Bars objects the script adds itself. Additional Bars objects from a multi-series chart or from other multi-series scripts that may be running concurrently will not be processed by this multi-series script.</p><p class="p_Normal">&nbsp;</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>If a multi-series script adds an additional Bars object that already exists on the chart, the script will use the preexisting series instead of creating a new one to conserve memory. This includes that series' <a href="using_the_trading_hours_window.html" class="topiclink">session template</a> as applied from the chart. If the Bars object does not exist on the chart, the session template of the added Bars object will be the session template of the primary Bars object. If the primary Bars object is using the &quot;&lt;Use instrument settings&gt;&quot; session template, then the additional Bars objects will use the default session templates as defined for their particular instruments in the <a href="instruments.html" class="topiclink">Instruments</a> window.</p><p class="p_Normal">&nbsp;</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>In a multi-series script, <span style="font-weight: bold;">CurrentBars</span> starting value will be -1 until all series have processed the first bar. To ensure you have satisfied this requirement on all your Bars objects, it is recommend you start your OnBarUpdate() method with <a href="currentbars.html" class="topiclink">CurrentBars</a> checks, as seen in the code sample above.</p><p class="p_Normal">&nbsp;</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>A multi-series indicator will hold the same number of data points for plots as the primary series. Setting values to plots should be done in the primary series in OnBarUpdate(). If you are using calculations based off of a larger secondary series, it may plot like a step ladder because there are more data points available than there are actual meaningful data values.</p><p class="p_Normal">&nbsp;</p>
<p class="p_Heading2" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>The default <a href="closestrategy.html" class="topiclink">CloseStrategy()</a> handling will only be applied to the primary series of a MultiSeries NinjaScript strategy.</p><h2 class="p_Heading2"><span class="f_Heading2">&nbsp;</span></h2>
<p class="p_Heading2" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>An indicator / strategy with multiple DataSeries of the same instrument will only process realtime OnBarUpdate() calls when a tick occurs in session of the trading hour templates of all added series. &nbsp;Any ticks not processed will be queued and processed as a tick comes in for all subsequent DataSeries.</p></td>
</tr>
</table>
</div>
</td>
</tr>
</table>
</div>
<p class="p_ToggleHeading"><img id="AccessingThePriceDataInAMultibarsninjascript_ICON" class="dropdown-toggle-icon" alt="tog_minus" width="16" height="16" style="margin:0;width:16px;height:16px;border:none" src="tog_minus.gif"/> &nbsp; &nbsp; &nbsp; &nbsp;<span class="f_ToggleHeading"><a class="dropdown-toggle" style="font-style: normal; font-weight: normal; color: #000000; background-color: transparent; text-decoration: none;" href="javascript:HMToggle('toggle','AccessingThePriceDataInAMultibarsninjascript','AccessingThePriceDataInAMultibarsninjascript_ICON')">Accessing&nbsp;the&nbsp;Price&nbsp;Data&nbsp;in&nbsp;a&nbsp;Multi-Bars&nbsp;NinjaScript</a></span></p>
<div id="AccessingThePriceDataInAMultibarsninjascript" class="dropdown-toggle-body" style="text-align: left; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 32px;"><table class="Toggle" >
<tr class="Toggle">
<td class="Toggle" style="background-color:#FFFFFF;"><p class="p_Normal">As you probably know already, you can access the current bar's closing price with the following statement:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><span style="font-weight: bold; color: #808080;"> &nbsp; &nbsp; Close[0];</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">You can also access price data such as the close price of other Bars objects at any time. This is accomplished by accessing the <a href="opens.html" class="topiclink">Opens</a>, <a href="highs.html" class="topiclink">Highs</a>, <a href="lows.html" class="topiclink">Lows</a>, <a href="closes.html" class="topiclink">Closes</a>, <a href="volumeseries.html" class="topiclink">Volumes</a>, <a href="medians.html" class="topiclink">Medians</a>, <a href="typicals.html" class="topiclink">Typicals</a> and <a href="timeseries.html" class="topiclink">Times</a> series by index value. These properties hold collections (containers) that hold their named values for all Bars objects in a script.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Continuing with our example code above, if you wanted to access the high price of the MSFT 3 minute Bars object at index 1 you would write: <br />
&nbsp;<br />
<span class="f_ExampleText"> &nbsp; &nbsp; Highs[1][0];</span></p>
<p class="p_Normal">&nbsp;<br />
This is just saying &quot;give me the series of high prices for the Bars object at index 1 'Highs[1]' and return to me the current high value '[0]'&quot;. If the BarsInProgress index was equal to 1, the current &nbsp;context is of the MSFT 3 min Bars object so you could just write: <br />
&nbsp;<br />
<span class="f_ExampleText"> &nbsp; &nbsp; High[0];</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">The following example demonstrates various ways to access price data.</p>
<p class="p_Normal">&nbsp;</p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table id="Code1" class="NSExample" >
<thead>
<tr class="NSExample">
<th class="NSExample" style="vertical-align:middle;"><h2 class="p_Heading2"><img alt="ns" width="20" height="20" style="margin:0;width:20px;height:20px;border:none" src="ns.png"/></h2>
</th>
</tr>
</thead>
<tbody>
<tr class="NSExample">
<td class="NSExample"><p class="p_CodeExample"><span class="f_CodeExample" style="color: #0000ff;">protected</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">override</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">OnBarUpdate()</span><br />
<span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// Checks to ensure all Bars objects contain enough bars before beginning</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// If this is a strategy, use BarsRequiredToTrade instead of BarsRequiredToPlot</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(CurrentBars[</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&lt;=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">BarsRequiredToPlot</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">||</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">CurrentBars[</span><span class="f_CodeExample" style="color: #ff6600;">1</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&lt;=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">BarsRequiredToPlot</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">||</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">CurrentBars[</span><span class="f_CodeExample" style="color: #ff6600;">2</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&lt;=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">BarsRequiredToPlot)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">;</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// Checks if OnBarUpdate() is called from an update on the primary Bars</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(BarsInProgress</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">==</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">primaryClose</span><span class="f_CodeExample" style="color: #ffffff;">  </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">Close[</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">];</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">msft3minClose</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">Closes[</span><span class="f_CodeExample" style="color: #ff6600;">1</span><span class="f_CodeExample">][</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">];</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">aapl1minClose</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">Closes[</span><span class="f_CodeExample" style="color: #ff6600;">2</span><span class="f_CodeExample">][</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">];</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// primaryClose could also be expressed as</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// primaryClose = Closes[0][0];</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// Checks if OnBarUpdate() is called from an update on MSFT 3 minute Bars object</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(BarsInProgress</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">==</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">1</span><span class="f_CodeExample">)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">primaryClose</span><span class="f_CodeExample" style="color: #ffffff;">  </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">Closes[</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">][</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">];</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">msft3minClose</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">Close[</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">];</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">aapl1minClose</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">Closes[</span><span class="f_CodeExample" style="color: #ff6600;">2</span><span class="f_CodeExample">][</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">];</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">}</span></p>
</td>
</tr>
</tbody>
</table>
</div>
</td>
</tr>
</table>
</div>
<p class="p_ToggleHeading"><img id="EnteringExitingAndRetrievingPositionInformation_ICON" class="dropdown-toggle-icon" alt="tog_minus" width="16" height="16" style="margin:0;width:16px;height:16px;border:none" src="tog_minus.gif"/> &nbsp; &nbsp; &nbsp; &nbsp;<span class="f_ToggleHeading"><a class="dropdown-toggle" style="font-style: normal; font-weight: normal; color: #000000; background-color: transparent; text-decoration: none;" href="javascript:HMToggle('toggle','EnteringExitingAndRetrievingPositionInformation','EnteringExitingAndRetrievingPositionInformation_ICON')">Entering,&nbsp;Exiting&nbsp;and&nbsp;Retrieving&nbsp;Position&nbsp;Information</a></span></p>
<div id="EnteringExitingAndRetrievingPositionInformation" class="dropdown-toggle-body" style="text-align: left; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 32px;"><table class="Toggle" >
<tr class="Toggle">
<td class="Toggle" style="background-color:#FFFFFF;"><p class="p_Normal">This section is relevant for NinjaScript strategies only. Entry and Exit methods are executed within the BarsInProgress context. Let's demonstrate with an example:</p>
<p class="p_Normal">&nbsp;</p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table id="Code1" class="NSExample" >
<thead>
<tr class="NSExample">
<th class="NSExample" style="vertical-align:middle;"><h2 class="p_Heading2"><img alt="ns" width="20" height="20" style="margin:0;width:20px;height:20px;border:none" src="ns.png"/></h2>
</th>
</tr>
</thead>
<tbody>
<tr class="NSExample">
<td class="NSExample"><p class="p_CodeExample"><span class="f_CodeExample" style="color: #0000ff;">protected</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">override</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">OnBarUpdate()</span><br />
<span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// Checks to ensure all Bars objects contain enough bars before beginning</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// If this is an indicator, use BarsRequiredToPlot instead of BarsRequiredToTrade</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(CurrentBars[</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&lt;=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">BarsRequiredToPlot</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">||</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">CurrentBars[</span><span class="f_CodeExample" style="color: #ff6600;">1</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&lt;=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">BarsRequiredToPlot</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">||</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">CurrentBars[</span><span class="f_CodeExample" style="color: #ff6600;">2</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&lt;=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">BarsRequiredToPlot)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">;</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// Checks if OnBarUpdate() is called from an update on the primary Bars</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(BarsInProgress</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">==</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// Submits a buy market order for MSFT</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">EnterLong();</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// Checks if OnBarUpdate() is called from an update on AAPL 1 minute Bars object</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(BarsInProgress</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">==</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">2</span><span class="f_CodeExample">)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// Submits a buy market order for AAPL</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">EnterLong();</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// Submits a buy market for MSFT when OnBarUpdate() is called for AAPL</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">EnterLong(</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">100</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #800000;">&quot;BUY MSFT&quot;</span><span class="f_CodeExample">);</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">}</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_Normal">&nbsp;<br />
As you can see above, orders are submitted for MSFT when BarsInProgress is equal to 0 and for AAPL when BarsInProgress is equal to 2. The orders submitted are within the context of the Bars object calling the OnBarUpdate() method and the instrument associated to the calling Bars object. There is one exception, which is the order placed for MSFT within the context of the OnBarUpdate() call for AAPL. Each order method has a variation that allows you to specify the BarsInProgress index value which enables submission of orders for any instrument within the context of another instrument.</p>
<p class="p_Normal">&nbsp;</p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table class="Note" >
<tr class="Note">
<td class="Note"><p class="p_Normal"><span style="font-weight: bold;">Notes</span>: </p>
<p class="p_Normal">1. Should you have multiple Bars objects of the same instrument while using Set() methods in your strategy, you should only submit orders for this instrument to the first Bars context of that instrument. This is to ensure your order logic is processed correctly and any necessary order amendments are done properly.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">2. Should you have multiple Bars objects of the same instrument while using options to terminate orders/positions at the end of the session (TIF=Day or <a href="isexitonsessionclosestrategy.html" class="topiclink">IsExitOnSessionCloseStrategy</a>=true), you should not submit orders to Bars objects other than the first Bars context for that instrument when on the last bar of the session. This is necessary because some of the end of session handling is applied only to the first Bars context of an instrument, and submitting orders to other Bars objects for that instrument can bypass the end-of-session handling.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">3. &nbsp;For <a href="advanced_order_handling.html" class="topiclink">advanced order methods</a>, if you <span style="font-weight: bold;">DO NOT</span> specify a BarsInProgress , the order will be submitted to the current bars in progress updating. &nbsp;If the current BarsInProgress is a higher time frame, this could delay the time that the order is filled during historical backtesting. &nbsp;As a result, you should always submit historical orders to the most granular of time frames.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">4. When backtesting and submitting orders 'On bar close' and utilizing OnExecutionUpdate or OnOrderUpdate to submit orders, these orders will be processed immediately and filled by the fill engine depending on if the order satisfies its fill condition. This evaluation is done by looking ahead to the next bar of the current series. This is done prior to any secondary higher granularity series having a chance to run its 'OnBarUpdate' logic. If you planned on running order logic in your highest granularity added series then please insure that you submit orders in all cases to the highest granularity series. </p>
</td>
</tr>
</table>
</div>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">The <a href="position.html" class="topiclink">Position</a> property always references the position of the instrument of the current context. If the BarsInProgress is equal to 2 (AAPL 1 minute Bars), Position would refer to the position being held for AAPL. The <a href="positions.html" class="topiclink">Positions</a> property holds a collection of Position objects for each instrument in a strategy. Note that there is a critical difference here. Throughout this entire section we have been dealing with Bars objects. Although in our sample we have three Bars objects (MSFT 1 and 3 min and AAPL 1 min) we only have two instruments in the strategy.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_ExampleText"><span class="f_ExampleText">MSFT position is given an index value of 0</span><br />
<span class="f_ExampleText">AAPL position is given an index value of 1</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">In the example below, when the OnBarUpdate() method is called for the primary Bars we also check if the position held for AAPL is NOT flat and then enter a long position in MSFT. The net result of this strategy is that a long position is entered for AAPL, and then once AAPL is long, we go long MSFT.</p>
<p class="p_Normal">&nbsp;</p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table id="Code1" class="NSExample" >
<thead>
<tr class="NSExample">
<th class="NSExample" style="vertical-align:middle;"><h2 class="p_Heading2"><img alt="ns" width="20" height="20" style="margin:0;width:20px;height:20px;border:none" src="ns.png"/></h2>
</th>
</tr>
</thead>
<tbody>
<tr class="NSExample">
<td class="NSExample"><p class="p_CodeExample"><span class="f_CodeExample" style="color: #0000ff;">protected</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">override</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">OnBarUpdate()</span><br />
<span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// Checks to ensure all Bars objects contain enough bars before beginning</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// If this is an indicator, use BarsRequiredToPlot instead of BarsRequiredToTrade</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(CurrentBars[</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&lt;=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">BarsRequiredToPlot</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">||</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">CurrentBars[</span><span class="f_CodeExample" style="color: #ff6600;">1</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&lt;=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">BarsRequiredToPlot</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">||</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">CurrentBars[</span><span class="f_CodeExample" style="color: #ff6600;">2</span><span class="f_CodeExample">]</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&lt;=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">BarsRequiredToPlot)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">return</span><span class="f_CodeExample">;</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// Checks if OnBarUpdate() is called from an update on the primary Bars</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(BarsInProgress</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">==</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&amp;&amp;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">Positions[</span><span class="f_CodeExample" style="color: #ff6600;">1</span><span class="f_CodeExample">].MarketPosition</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">!=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">MarketPosition.Flat)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// Submits a buy market order for MSFT</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">EnterLong();</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// Checks if OnBarUpdate() is called from an update on AAPL 1 minute Bars</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(BarsInProgress</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">==</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">2</span><span class="f_CodeExample">)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// Submits a buy market order for AAPL</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">EnterLong();</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">}</span></p>
</td>
</tr>
</tbody>
</table>
</div>
</td>
</tr>
</table>
</div>

        <!--ZOOMSTOP-->
      </div>
      <script type="text/javascript">
      
      var lastSlashPos = document.URL.lastIndexOf("https://ninjatrader.com/") > document.URL.lastIndexOf("\\") ? document.URL.lastIndexOf("https://ninjatrader.com/") : document.URL.lastIndexOf("\\");
      if (document.URL.substring(lastSlashPos + 1, lastSlashPos + 4).toLowerCase() != "~hh") {
      if (document.all) setTimeout(function() {
      nsrInit();
      }, 20);
      else nsrInit();
      }
      
      
      if ((!parent.hmNavigationFrame) && (parent.location) && (parent.location.href)) {
      $('.sync-toc').show();
      $('p.crumbs').hide();
      }
      
      
      </script>
      <div id="bump" style="height: 25px"></div>
    <script type="text/javascript">
HMInitToggle('WorkingWithMultiTimeFrameObjects_ICON','hm.type','dropdown','hm.state','0','hm.src0','tog_plus.gif','hm.src1','tog_minus.gif','onclick','HMToggle(\'toggle\',\'WorkingWithMultiTimeFrameObjects\',\'WorkingWithMultiTimeFrameObjects_ICON\')');
HMInitToggle('WorkingWithMultiTimeFrameObjects','hm.type','dropdown','hm.state','0');
HMInitToggle('AddingAdditionalBarsObjectToninjascript_ICON','hm.type','dropdown','hm.state','0','hm.src0','tog_plus.gif','hm.src1','tog_minus.gif','onclick','HMToggle(\'toggle\',\'AddingAdditionalBarsObjectToninjascript\',\'AddingAdditionalBarsObjectToninjascript_ICON\')');
HMInitToggle('AddingAdditionalBarsObjectToninjascript','hm.type','dropdown','hm.state','0');
HMInitToggle('CreatingSeriesObjects_ICON','hm.type','dropdown','hm.state','0','hm.src0','tog_plus.gif','hm.src1','tog_minus.gif','onclick','HMToggle(\'toggle\',\'CreatingSeriesObjects\',\'CreatingSeriesObjects_ICON\')');
HMInitToggle('CreatingSeriesObjects','hm.type','dropdown','hm.state','0');
HMInitToggle('HowBarsDataIsReferenced_ICON','hm.type','dropdown','hm.state','0','hm.src0','tog_plus.gif','hm.src1','tog_minus.gif','onclick','HMToggle(\'toggle\',\'HowBarsDataIsReferenced\',\'HowBarsDataIsReferenced_ICON\')');
HMInitToggle('HowBarsDataIsReferenced','hm.type','dropdown','hm.state','0');
HMInitToggle('UsingBarsObjectsAsInputToIndicatorMethods_ICON','hm.type','dropdown','hm.state','0','hm.src0','tog_plus.gif','hm.src1','tog_minus.gif','onclick','HMToggle(\'toggle\',\'UsingBarsObjectsAsInputToIndicatorMethods\',\'UsingBarsObjectsAsInputToIndicatorMethods_ICON\')');
HMInitToggle('UsingBarsObjectsAsInputToIndicatorMethods','hm.type','dropdown','hm.state','0');
HMInitToggle('TrueEventDrivenOnbarupdateMethod_ICON','hm.type','dropdown','hm.state','0','hm.src0','tog_plus.gif','hm.src1','tog_minus.gif','onclick','HMToggle(\'toggle\',\'TrueEventDrivenOnbarupdateMethod\',\'TrueEventDrivenOnbarupdateMethod_ICON\')');
HMInitToggle('TrueEventDrivenOnbarupdateMethod','hm.type','dropdown','hm.state','0');
HMInitToggle('AccessingThePriceDataInAMultibarsninjascript_ICON','hm.type','dropdown','hm.state','0','hm.src0','tog_plus.gif','hm.src1','tog_minus.gif','onclick','HMToggle(\'toggle\',\'AccessingThePriceDataInAMultibarsninjascript\',\'AccessingThePriceDataInAMultibarsninjascript_ICON\')');
HMInitToggle('AccessingThePriceDataInAMultibarsninjascript','hm.type','dropdown','hm.state','0');
HMInitToggle('EnteringExitingAndRetrievingPositionInformation_ICON','hm.type','dropdown','hm.state','0','hm.src0','tog_plus.gif','hm.src1','tog_minus.gif','onclick','HMToggle(\'toggle\',\'EnteringExitingAndRetrievingPositionInformation\',\'EnteringExitingAndRetrievingPositionInformation_ICON\')');
HMInitToggle('EnteringExitingAndRetrievingPositionInformation','hm.type','dropdown','hm.state','0');
</script>
</body>
  
<!-- Mirrored from ninjatrader.com/support/helpGuides/nt8/multi-time_frame__instruments.htm by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 26 Jan 2023 19:55:42 GMT -->
</html>
