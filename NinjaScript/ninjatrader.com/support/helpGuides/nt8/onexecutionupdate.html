<!DOCTYPE html>
<html>
  
<!-- Mirrored from ninjatrader.com/support/helpGuides/nt8/onexecutionupdate.htm by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 26 Jan 2023 20:00:47 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <title>NinjaScript &gt; Language Reference &gt; Strategy &gt; OnExecutionUpdate()</title>
    <meta name="generator" content="Help &amp; Manual" />
    <meta name="keywords" content="OnExecutionUpdate() - Strategy" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link type="text/css" href="default.css" rel="stylesheet" />
    <link type="text/css" href="custom.css" rel="stylesheet">
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="nt_custom.js"></script>
    <style TYPE="text/css" media="screen">
    html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: #FFFFFF;
    line-height: 1.15
    }
    
    div#printheader {
    display: none
    }
    #idheader {
    width: 100%;
    height: auto;
    padding: 0;
    margin: 0
    }
    #idcontent {
    position: relative
    }
    #callout-table, #overview-table {
    display: block;
    position: relative;
    top: 0;
    left: 0
    }
    #callout-icon {
    display: block;
    position: absolute;
    top: -11px;
    left: -11px
    }
    #callout-icon-flag {
    display: block;
    position: absolute;
    top: -11px;
    left: -8px
    }
    #callout-table a {
    text-decoration: none;
    color: blue
    }
    #callout-table a:visited {
    text-decoration: none;
    color: blue
    }
    #overview-table a {
    text-decoration: none;
    color: black
    }
    #overview-table a:visited {
    text-decoration: none;
    color: black
    }
    #callout-table a:hover, #overview-table a:hover {
    text-decoration: underline
    }
    #switchtoggles {
    text-align: right;
    padding: 0 5px 0 0;
    font-size: 90%
    }
    p.help-url {
    margin: 20px 0 5px 0;
    text-align: center;
    font-size: 80%;
    text-decoration: none
    }
    .sync-toc {
    color: #ffffff;
    font-size: 8pt;
    font-weight: bold;
    display: none
    }
    .sync-toc a {
    color: #ffffff;
    text-decoration: none;
    font-weight: bold
    }
    .sync-toc a:visited {
    color: #ffffff
    }
    .sync-toc a:hover {
    text-decoration: underline
    }
    .p_ToggleHeading:active {
    box-shadow: 0px 0px 4px #9ecaed
    }                    
    .Needs {
      border-color: #008000 !important;
      background-color: #f3f9f4;
    }
    .Under {
      border-color: #ffcc00 !important;
      background-color: #fffdf6;
    }
    </style>
    <noscript>
    <style type="text/css">
    html, body { overflow: auto; }
    </style>
    </noscript>
    <style type="text/css" media="print">
    span.f_Heading1 { color: black; }
    #idheader, #printheader img { display:none; }
    #printheader { display: block; margin-top: 20px; }
    #idcontent { margin-top: 10px; position:relative }
    </style>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="helpman_settings.js"></script>
    <script type="text/javascript" src="helpman_topicinit.js"></script>
    <script type="text/javascript" src="nsh.js"></script>
    
    
    
  
   <script type="text/javascript">
     HMSyncTOC("NT%20HelpGuide%20English.html", "onexecutionupdate.html");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
  <body>
    
    
    
    <div id="printheader"><p class="p_HeadingTopic"><span class="f_HeadingTopic">OnExecutionUpdate()</span></p>
</div>
    <div id="idheader">
      <div id="idheaderbg">
        <table style="width:100%;border:none;margin:0px;background:#A41E22" cellspacing="0" cellpadding="0">
          <tr valign="bottom">
            <td align="left" valign="bottom" class="topichead">
              <p class="sync-toc">&lt;&lt; <a rel="nofollow" href="NT%20HelpGuide%20English3b6a.html?onexecutionupdate.htm" target="_top">Click to Display Table of Contents</a> &gt;&gt;</p>
              <p class="crumbs" id="idnav"><b>Navigation:</b>&nbsp;
                
              <a href="ninjascript.html">NinjaScript</a> &gt; <a href="language_reference_wip.html">Language Reference</a> &gt; <a href="strategy.html">Strategy</a>&nbsp;&gt;</p>
              <p class="p_HeadingTopic"><span class="f_HeadingTopic">OnExecutionUpdate()</span></p>

            </td>
            <td align="right" width="120" valign="middle" class="topichead" id="idnav">
              
              <a href="accountitemeventargs.html"><img name="prev" src="leftArrow.png" border=0 alt="Previous page"></a>
              
              <a href="strategy.html"><img name=main src="upArrow.png" border=0 alt="Return to chapter overview"></a>
              <a href="onordertrace.html"><img name=next src="rightArrow.png" border=0 alt="Next page"></a>
              
            </td>
          </tr>
        </table>
<!-- PM review header         
        <div id="status" class="" style="margin-bottom: 0px; min-height: 25px;font-size: small; border-bottom: solid 3px;  padding: 5px;">
          <b></b>: <span id="explain"></span>
        </div>
-->        
        <!-- The following code displays Expand All/Collapse All links  below the header in topics containing toggles -->
        
      </div>
    </div>
    
    <div id="idcontent">
      <div id="innerdiv">
        <!-- Ask Internet Explorer 6.users to update their obsolete and dangerous browser -->
        <!--[if lt IE 7]><div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;'><a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0000_us.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." /></a></div><![endif]-->
        
        <!--ZOOMRESTART-->
        <h2 class="p_Heading2"><span class="f_Heading2">Definition</span></h2>
<p class="p_Definition">An event driven method which is called on an incoming execution of an order managed by a strategy. An execution is another name for a fill of an order.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>An order can generate multiple executions (partial fills)</p><p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>OnExecutionUpdate is typically called after <a href="onorderupdate.html" class="topiclink">OnOrderUpdate()</a> is called </p><p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>Only orders which have been submitted and managed by the strategy will call OnExecutionUpdate()</p><p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>Executions drive the strategy <a href="position.html" class="topiclink">Position</a> object, which is updated when this method is called</p><p class="p_Normal">&nbsp;</p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table class="Note" >
<tr class="Note">
<td class="Note"><p class="p_Normal"><span style="font-weight: bold;">Notes</span>: &nbsp;</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>Programming in this environment is reserved for the more <a href="advanced_order_handling.html" class="topiclink">advanced user</a>. If you are for example looking to protect a strategy managed position with a basic stop and target, then the <a href="managed_approach.html" class="topiclink">Set() methods</a> would be more convenient.</p><p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>When connected to the Playback connection, it is possible for OnExecutionUpdate() to trigger in the middle of a call to OnBarUpdate(). The Sim101 account adds a simulated random delay for processing execution events, but the Playback connection triggers executions immediately, for the sake of consistency in backtesting. Because of this, OnExecutionUpdate() can appear to be triggered earlier than it would in live trading, or when simulation trading on a live connection.</p><p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>Please also review <a href="multi-threading.html" class="topiclink">Multi-Thread Considerations for NinjaScript</a></p><p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>Its best practice to only work with the passed by value parameters and not reference parameters. This insures that you process each change of the underlying state. </p><p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>Rithmic and Interactive Brokers Users: When using a NinjaScript strategy it is best practice to only work with passed by value data from OnExecution. Instances of multiple fills at the same time for the same instrument might result in an incorrect OnPositionUpdate, as sequence of events are not guaranteed due to provider API design. </p></td>
</tr>
</table>
</div>
<p class="p_Normal">&nbsp;</p>
<h2 class="p_Heading2"><span class="f_Heading2">Method Return Value</span></h2>
<p class="p_Normal">This method does not return a value.</p>
<p class="p_Normal">&nbsp;</p>
<h2 class="p_Heading2"><span class="f_Heading2">Syntax</span><br />
You must override the method in your strategy with the following syntax:</h2>
<p class="p_Normal">&nbsp;</p>
<p class="p_CodeExample"><span class="f_CodeExample" style="color: #0000ff;">protected</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">override</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">OnExecutionUpdate(Execution</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">execution,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">executionId,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">price,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">quantity,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">MarketPosition</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">marketPosition,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">orderId,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">DateTime</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">time)</span><br />
<span class="f_CodeExample">{</span><span class="f_CodeExample" style="color: #ffffff;"> </span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample">}</span></p>
<p class="p_Normal">&nbsp;</p>
<h2 class="p_Heading2"><span class="f_Heading2">Parameters</span></h2>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table style="width:80%; background-color:#ffffff; border:none; border-spacing:0; border-collapse:collapse;">
<tr>
<td style="vertical-align:top; width:30%; background-color:#F9F9F9; padding:10px; border:solid thin #dddddd;"><p class="p_Normal">execution</p>
</td>
<td style="vertical-align:top; background-color:#F9F9F9; padding:10px; border:solid thin #dddddd;"><p class="p_Normal">An <a href="execution.html" class="topiclink">Execution</a> object passed by reference representing the execution</p>
</td>
</tr>
<tr>
<td style="vertical-align:top; width:30%; padding:10px; border:solid thin #dddddd;"><p class="p_Normal">executionId</p>
</td>
<td style="vertical-align:top; padding:10px; border:solid thin #dddddd;"><p class="p_Normal">A <span class="f_CodeExampleTypes">string</span> value representing the execution id</p>
</td>
</tr>
<tr>
<td style="vertical-align:top; width:30%; background-color:#F9F9F9; padding:10px; border:solid thin #dddddd;"><p class="p_Normal">price</p>
</td>
<td style="vertical-align:top; background-color:#F9F9F9; padding:10px; border:solid thin #dddddd;"><p class="p_Normal">A <span class="f_CodeExampleTypes">double</span> value representing the execution price</p>
</td>
</tr>
<tr>
<td style="vertical-align:top; width:30%; padding:10px; border:solid thin #dddddd;"><p class="p_Normal">quantity</p>
</td>
<td style="vertical-align:top; padding:10px; border:solid thin #dddddd;"><p class="p_Normal">An <span class="f_CodeExampleTypes">int</span> value representing the execution quantity</p>
</td>
</tr>
<tr>
<td style="vertical-align:top; width:30%; background-color:#F9F9F9; padding:10px; border:solid thin #dddddd;"><p class="p_Normal">marketPosition</p>
</td>
<td style="vertical-align:top; background-color:#F9F9F9; padding:10px; border:solid thin #dddddd;"><p class="p_Normal">A <a href="position_marketposition.html" class="topiclink">MarketPosition</a> object representing the position of the execution. &nbsp;Possible values are:</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>MarketPosition.Long</p><p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>MarketPosition.Short</p></td>
</tr>
<tr>
<td style="vertical-align:top; width:30%; padding:10px; border:solid thin #dddddd;"><p class="p_Normal">orderId</p>
</td>
<td style="vertical-align:top; padding:10px; border:solid thin #dddddd;"><p class="p_Normal">A <span class="f_CodeExampleTypes">string</span> representing the order id</p>
</td>
</tr>
<tr>
<td style="vertical-align:top; width:30%; background-color:#F9F9F9; padding:10px; border:solid thin #dddddd;"><p class="p_Normal">time</p>
</td>
<td style="vertical-align:top; background-color:#F9F9F9; padding:10px; border:solid thin #dddddd;"><p class="p_Normal">A <a href="http://msdn.microsoft.com/en-us/library/system.datetime.aspx" target="_blank" onclick="return HMTrackTopiclink(this);" class="weblink">DateTime</a> value representing the time of the execution</p>
</td>
</tr>
</table>
</div>
<p class="p_Normal">&nbsp;</p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table id="Code1" class="NSExample" >
<thead>
<tr class="NSExample">
<th class="NSExample" style="vertical-align:middle;"><h2 class="p_Heading2"><img alt="ns" width="20" height="20" style="margin:0;width:20px;height:20px;border:none" src="ns.png"/><span class="f_ImageCaption"> </span><span class="f_NSexamplesheading">OnExecutionUpdate Example (See <a href="using_onorderupdate_and_onexec.html" class="topiclink">SampleOnOrderUpdate</a> for complete example)</span></h2>
</th>
</tr>
</thead>
<tbody>
<tr class="NSExample">
<td class="NSExample"><h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">private</span><span style="font-size: 9pt; font-family: Consolas;"> Order entryOrder = </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">null</span><span style="font-size: 9pt; font-family: Consolas;">; </span><span style="font-size: 9pt; font-family: Consolas; color: #008000;">// This variable holds an object representing our entry order</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">private</span><span style="font-size: 9pt; font-family: Consolas;"> Order stopOrder = </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">null</span><span style="font-size: 9pt; font-family: Consolas;">; </span><span style="font-size: 9pt; font-family: Consolas; color: #008000;">// This variable holds an object representing our stop loss order</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">private</span><span style="font-size: 9pt; font-family: Consolas;"> Order targetOrder = </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">null</span><span style="font-size: 9pt; font-family: Consolas;">; </span><span style="font-size: 9pt; font-family: Consolas; color: #008000;">// This variable holds an object representing our profit target order</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">private</span><span style="font-size: 9pt; font-family: Consolas;"> </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">int</span><span style="font-size: 9pt; font-family: Consolas;"> sumFilled = 0; </span><span style="font-size: 9pt; font-family: Consolas; color: #008000;">// This variable tracks the quantities of each execution making up the entry order</span></h2>
<h2 class="p_Heading2"><span class="f_Heading2">&nbsp;</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">protected</span><span style="font-size: 9pt; font-family: Consolas;"> </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">override</span><span style="font-size: 9pt; font-family: Consolas;"> </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">void</span><span style="font-size: 9pt; font-family: Consolas;"> OnExecutionUpdate(Execution execution, </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">string</span><span style="font-size: 9pt; font-family: Consolas;"> executionId, </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">double</span><span style="font-size: 9pt; font-family: Consolas;"> price, </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">int</span><span style="font-size: 9pt; font-family: Consolas;"> quantity, MarketPosition marketPosition, </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">string</span><span style="font-size: 9pt; font-family: Consolas;"> orderId, DateTime time)</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;">{</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp;  </span><span style="font-size: 9pt; font-family: Consolas; color: #008000;">/* We advise monitoring OnExecution to trigger submission of stop/target orders instead of OnOrderUpdate() since OnExecution() is called after OnOrderUpdate()</span></h2>
<h2 class="p_Heading2"><span style="width:48px;display:inline-block">&nbsp;</span><span style="font-size: 9pt; font-family: Consolas; color: #008000;">which ensures your strategy has received the execution which is used for internal signal tracking. */</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp;  </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">if</span><span style="font-size: 9pt; font-family: Consolas;"> (entryOrder != </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">null</span><span style="font-size: 9pt; font-family: Consolas;"> &amp;&amp; entryOrder == execution.Order)</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp;{</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp;  </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">if</span><span style="font-size: 9pt; font-family: Consolas;"> (execution.Order.OrderState == OrderState.Filled || execution.Order.OrderState == OrderState.PartFilled || (execution.Order.OrderState == OrderState.Cancelled &amp;&amp; execution.Order.Filled &gt; 0))</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp;{</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span><span style="font-size: 9pt; font-family: Consolas; color: #008000;">// We sum the quantities of each execution making up the entry order</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sumFilled += execution.Quantity;</span></h2>
<h2 class="p_Heading2"><span class="f_Heading2">&nbsp;</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span><span style="font-size: 9pt; font-family: Consolas; color: #008000;">// Submit exit orders for partial fills</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">if</span><span style="font-size: 9pt; font-family: Consolas;"> (execution.Order.OrderState == OrderState.PartFilled)</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stopOrder = ExitLongStopMarket(0, </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">true</span><span style="font-size: 9pt; font-family: Consolas;">, execution.Order.Filled, execution.Order.AverageFillPrice - 4 * TickSize, </span><span style="font-size: 9pt; font-family: Consolas; color: #a31515;">&quot;MyStop&quot;</span><span style="font-size: 9pt; font-family: Consolas;">, </span><span style="font-size: 9pt; font-family: Consolas; color: #a31515;">&quot;MyEntry&quot;</span><span style="font-size: 9pt; font-family: Consolas;">);</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;targetOrder = ExitLongLimit(0, </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">true</span><span style="font-size: 9pt; font-family: Consolas;">, execution.Order.Filled, execution.Order.AverageFillPrice + 8 * TickSize, </span><span style="font-size: 9pt; font-family: Consolas; color: #a31515;">&quot;MyTarget&quot;</span><span style="font-size: 9pt; font-family: Consolas;">, </span><span style="font-size: 9pt; font-family: Consolas; color: #a31515;">&quot;MyEntry&quot;</span><span style="font-size: 9pt; font-family: Consolas;">);</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span><span style="font-size: 9pt; font-family: Consolas; color: #008000;">// Update our exit order quantities once orderstate turns to filled and we have seen execution quantities match order quantities</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">else</span><span style="font-size: 9pt; font-family: Consolas;"> </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">if</span><span style="font-size: 9pt; font-family: Consolas;"> (execution.Order.OrderState == OrderState.Filled &amp;&amp; sumFilled == execution.Order.Filled)</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span><span style="font-size: 9pt; font-family: Consolas; color: #008000;">// Stop-Loss order for OrderState.Filled</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stopOrder = ExitLongStopMarket(0, </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">true</span><span style="font-size: 9pt; font-family: Consolas;">, execution.Order.Filled, execution.Order.AverageFillPrice - 4 * TickSize, </span><span style="font-size: 9pt; font-family: Consolas; color: #a31515;">&quot;MyStop&quot;</span><span style="font-size: 9pt; font-family: Consolas;">, </span><span style="font-size: 9pt; font-family: Consolas; color: #a31515;">&quot;MyEntry&quot;</span><span style="font-size: 9pt; font-family: Consolas;">);</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;targetOrder = ExitLongLimit(0, </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">true</span><span style="font-size: 9pt; font-family: Consolas;">, execution.Order.Filled, execution.Order.AverageFillPrice + 8 * TickSize, </span><span style="font-size: 9pt; font-family: Consolas; color: #a31515;">&quot;MyTarget&quot;</span><span style="font-size: 9pt; font-family: Consolas;">, </span><span style="font-size: 9pt; font-family: Consolas; color: #a31515;">&quot;MyEntry&quot;</span><span style="font-size: 9pt; font-family: Consolas;">);</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></h2>
<h2 class="p_Heading2"><span class="f_Heading2">&nbsp;</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span><span style="font-size: 9pt; font-family: Consolas; color: #008000;">// Resets the entryOrder object and the sumFilled counter to null / 0 after the order has been filled</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">if</span><span style="font-size: 9pt; font-family: Consolas;"> (execution.Order.OrderState != OrderState.PartFilled &amp;&amp; sumFilled == execution.Order.Filled)</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;{</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;entryOrder = </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">null</span><span style="font-size: 9pt; font-family: Consolas;">;</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;sumFilled = 0;</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;}</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp;}</span></h2>
<h2 class="p_Heading2"><span class="f_Heading2">&nbsp;</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp;  </span><span style="font-size: 9pt; font-family: Consolas; color: #008000;">// Reset our stop order and target orders' Order objects after our position is closed. (1st Entry)</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp;  </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">if</span><span style="font-size: 9pt; font-family: Consolas;"> ((stopOrder != </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">null</span><span style="font-size: 9pt; font-family: Consolas;"> &amp;&amp; stopOrder == execution.Order) || (targetOrder != </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">null</span><span style="font-size: 9pt; font-family: Consolas;"> &amp;&amp; targetOrder == execution.Order))</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp;{</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp;  </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">if</span><span style="font-size: 9pt; font-family: Consolas;"> (execution.Order.OrderState == OrderState.Filled || execution.Order.OrderState == OrderState.PartFilled)</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp;{</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;stopOrder = </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">null</span><span style="font-size: 9pt; font-family: Consolas;">;</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;targetOrder = </span><span style="font-size: 9pt; font-family: Consolas; color: #0000ff;">null</span><span style="font-size: 9pt; font-family: Consolas;">;</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp; &nbsp; &nbsp;}</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;"> &nbsp; &nbsp;}</span></h2>
<h2 class="p_Heading2"><span style="font-size: 9pt; font-family: Consolas;">}</span></h2>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table id="Code1" class="NSExample" >
<thead>
<tr class="NSExample">
<th class="NSExample" style="vertical-align:middle;"><h2 class="p_Heading2"><img alt="ns" width="20" height="20" style="margin:0;width:20px;height:20px;border:none" src="ns.png"/><span class="f_ImageCaption"> </span><span class="f_NSexamplesheading">Using Execution information to calculate Average Entry Price (Rithmic/Interactive Brokers Friendly Approach)</span></h2>
</th>
</tr>
</thead>
<tbody>
<tr class="NSExample">
<td class="NSExample"><p class="p_CodeExample"><span class="f_CodeExample" style="color: #0000ff;">private</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">Order</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">targetLong1</span><span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">null</span><span class="f_CodeExample">;</span><br />
<span class="f_CodeExample" style="color: #0000ff;">private</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">Order</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">stopLossLong1</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">null</span><span class="f_CodeExample">;</span><br />
<span class="f_CodeExample" style="color: #0000ff;">private</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">sumFilledLong1</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #008000;">// This variable tracks the quantities of each execution making up the entry order</span><br />
<span class="f_CodeExample" style="color: #0000ff;">private</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">List&lt;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&gt;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">LongEntry1Prices;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #008000;">// This List is used to track the fill prices of the entry order</span><br />
<span class="f_CodeExample" style="color: #008000;">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #0000ff;">protected</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">override</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">OnExecutionUpdate(Execution</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">execution,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">executionId,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">price,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">quantity,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">MarketPosition</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">marketPosition,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">orderId,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">DateTime</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">time)</span><br />
<span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// Use execution.Name to identify the order, so we are not using execution.Order, which may not be up to date if an ExecutionUpdate is seen before an OrderUpdate in a partial fill</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(execution.Name</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">==</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #800000;">&quot;Long limit entry 1&quot;</span><span class="f_CodeExample">)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp;  </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// We sum the quantities of each execution making up the entry order</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">sumFilledLong1</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">+=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">execution.Quantity;</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(LongEntry1Prices.IsNullOrEmpty())</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">LongEntry1Prices</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">new</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">List&lt;</span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample">&gt;();</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">for</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">i</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">i</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&lt;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">execution.Quantity;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">i++)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">LongEntry1Prices.Add(execution.Price);</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// Now we can calculate the average entry price, and use it to protect the specifc entry</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">double</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">averageEntryPrice</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">for</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(</span><span class="f_CodeExample" style="color: #0000ff;">int</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">i</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">i</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&lt;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">LongEntry1Prices.Count;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">i++)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">averageEntryPrice</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">+=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">LongEntry1Prices[i];</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">averageEntryPrice</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">/=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">LongEntry1Prices.Count;</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(stopLossLong1</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">==</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">null</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">&amp;&amp;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">targetLong1</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">==</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">null</span><span class="f_CodeExample">)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// Directly assign order objects from the method's return value. This prevents us from overprotecting the position by making sure our code changes the orders, instead of submitting new orders</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">stopLossLong1</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">ExitLongStopMarket(</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">true</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">sumFilledLong1,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">averageEntryPrice</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">-</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">StopDistance</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">*</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">TickSize,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #800000;">&quot;StopLossLong1&quot;</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #800000;">&quot;Long limit entry 1&quot;</span><span class="f_CodeExample">);</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">targetLong1</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">ExitLongLimit(</span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">true</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">sumFilledLong1,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">averageEntryPrice</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">+</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">ProfitDistance</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">*</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">TickSize,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #800000;">&quot;TargetLong1&quot;</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #800000;">&quot;Long limit entry 1&quot;</span><span class="f_CodeExample">);</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">else</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">ChangeOrder(stopLossLong1,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">sumFilledLong1,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">averageEntryPrice</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">-</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">StopDistance</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">*</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">TickSize);</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">ChangeOrder(targetLong1,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">sumFilledLong1,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">averageEntryPrice</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">+</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">ProfitDistance</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">*</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">TickSize,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">);</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// Entry Order filled, and stops and targets submitted. Reset Price list and running Filled quantity</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(sumFilledLong1</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">==</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">entryQuantity1)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// Move to Class?</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">sumFilledLong1</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #ff6600;">0</span><span class="f_CodeExample">;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">LongEntry1Prices.Clear();</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp;  </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">}</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_Normal">&nbsp;<br />
<span class="f_Heading2">Additional Reference Samples</span><br />
Additional reference code samples are available the NinjaScript Educational Resources section of our support forum.</p>

        <!--ZOOMSTOP-->
      </div>
      <script type="text/javascript">
      
      var lastSlashPos = document.URL.lastIndexOf("https://ninjatrader.com/") > document.URL.lastIndexOf("\\") ? document.URL.lastIndexOf("https://ninjatrader.com/") : document.URL.lastIndexOf("\\");
      if (document.URL.substring(lastSlashPos + 1, lastSlashPos + 4).toLowerCase() != "~hh") {
      if (document.all) setTimeout(function() {
      nsrInit();
      }, 20);
      else nsrInit();
      }
      
      
      if ((!parent.hmNavigationFrame) && (parent.location) && (parent.location.href)) {
      $('.sync-toc').show();
      $('p.crumbs').hide();
      }
      
      
      </script>
      <div id="bump" style="height: 25px"></div>
    </body>
  
<!-- Mirrored from ninjatrader.com/support/helpGuides/nt8/onexecutionupdate.htm by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 26 Jan 2023 20:00:47 GMT -->
</html>
