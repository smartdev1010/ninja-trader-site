<!DOCTYPE html>
<html>
  
<!-- Mirrored from ninjatrader.com/support/helpGuides/nt8/understanding_the_lifecycle_of.htm by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 26 Jan 2023 19:55:42 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <title>NinjaScript &gt; Educational Resources &gt; NinjaScript Lifecycle</title>
    <meta name="generator" content="Help &amp; Manual" />
    <meta name="keywords" content="" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link type="text/css" href="default.css" rel="stylesheet" />
    <link type="text/css" href="custom.css" rel="stylesheet">
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="nt_custom.js"></script>
    <style TYPE="text/css" media="screen">
    html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: #FFFFFF;
    line-height: 1.15
    }
    
    div#printheader {
    display: none
    }
    #idheader {
    width: 100%;
    height: auto;
    padding: 0;
    margin: 0
    }
    #idcontent {
    position: relative
    }
    #callout-table, #overview-table {
    display: block;
    position: relative;
    top: 0;
    left: 0
    }
    #callout-icon {
    display: block;
    position: absolute;
    top: -11px;
    left: -11px
    }
    #callout-icon-flag {
    display: block;
    position: absolute;
    top: -11px;
    left: -8px
    }
    #callout-table a {
    text-decoration: none;
    color: blue
    }
    #callout-table a:visited {
    text-decoration: none;
    color: blue
    }
    #overview-table a {
    text-decoration: none;
    color: black
    }
    #overview-table a:visited {
    text-decoration: none;
    color: black
    }
    #callout-table a:hover, #overview-table a:hover {
    text-decoration: underline
    }
    #switchtoggles {
    text-align: right;
    padding: 0 5px 0 0;
    font-size: 90%
    }
    p.help-url {
    margin: 20px 0 5px 0;
    text-align: center;
    font-size: 80%;
    text-decoration: none
    }
    .sync-toc {
    color: #ffffff;
    font-size: 8pt;
    font-weight: bold;
    display: none
    }
    .sync-toc a {
    color: #ffffff;
    text-decoration: none;
    font-weight: bold
    }
    .sync-toc a:visited {
    color: #ffffff
    }
    .sync-toc a:hover {
    text-decoration: underline
    }
    .p_ToggleHeading:active {
    box-shadow: 0px 0px 4px #9ecaed
    }                    
    .Needs {
      border-color: #008000 !important;
      background-color: #f3f9f4;
    }
    .Under {
      border-color: #ffcc00 !important;
      background-color: #fffdf6;
    }
    </style>
    <noscript>
    <style type="text/css">
    html, body { overflow: auto; }
    </style>
    </noscript>
    <style type="text/css" media="print">
    span.f_Heading1 { color: black; }
    #idheader, #printheader img { display:none; }
    #printheader { display: block; margin-top: 20px; }
    #idcontent { margin-top: 10px; position:relative }
    </style>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="helpman_settings.js"></script>
    <script type="text/javascript" src="helpman_topicinit.js"></script>
    <script type="text/javascript" src="nsh.js"></script>
    
    
    
  
   <script type="text/javascript">
     HMSyncTOC("NT%20HelpGuide%20English.html", "understanding_the_lifecycle_of.html");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
  <body>
    
    
    
    <div id="printheader"><p class="p_HeadingTopic"><span class="f_HeadingTopic">NinjaScript Lifecycle</span></p>
</div>
    <div id="idheader">
      <div id="idheaderbg">
        <table style="width:100%;border:none;margin:0px;background:#A41E22" cellspacing="0" cellpadding="0">
          <tr valign="bottom">
            <td align="left" valign="bottom" class="topichead">
              <p class="sync-toc">&lt;&lt; <a rel="nofollow" href="NT%20HelpGuide%20English61d4.html?understanding_the_lifecycle_of.htm" target="_top">Click to Display Table of Contents</a> &gt;&gt;</p>
              <p class="crumbs" id="idnav"><b>Navigation:</b>&nbsp;
                
              <a href="ninjascript.html">NinjaScript</a> &gt; <a href="educational_resources.html">Educational Resources</a>&nbsp;&gt;</p>
              <p class="p_HeadingTopic"><span class="f_HeadingTopic">NinjaScript Lifecycle</span></p>

            </td>
            <td align="right" width="120" valign="middle" class="topichead" id="idnav">
              
              <a href="multi-time_frame__instruments.html"><img name="prev" src="leftArrow.png" border=0 alt="Previous page"></a>
              
              <a href="educational_resources.html"><img name=main src="upArrow.png" border=0 alt="Return to chapter overview"></a>
              <a href="using_3rd_party_indicators.html"><img name=next src="rightArrow.png" border=0 alt="Next page"></a>
              
            </td>
          </tr>
        </table>
<!-- PM review header         
        <div id="status" class="" style="margin-bottom: 0px; min-height: 25px;font-size: small; border-bottom: solid 3px;  padding: 5px;">
          <b></b>: <span id="explain"></span>
        </div>
-->        
        <!-- The following code displays Expand All/Collapse All links  below the header in topics containing toggles -->
        
      </div>
    </div>
    
    <div id="idcontent">
      <div id="innerdiv">
        <!-- Ask Internet Explorer 6.users to update their obsolete and dangerous browser -->
        <!--[if lt IE 7]><div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;'><a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0000_us.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." /></a></div><![endif]-->
        
        <!--ZOOMRESTART-->
        <p class="p_Normal">NinjaTrader uses a <a href="state.html" class="topiclink">State</a> change system to represent various life cycles of your NinjaScript object. &nbsp;For more basic indicators and strategies, simply understanding each <span style="font-weight: bold;">State</span> described on the <a href="onstatechange.html" class="topiclink">OnStateChange()</a> page is sufficient. &nbsp;However, for more advanced development projects, it is critical to understand how NinjaTrader calls these states for various instances throughout the lifetime of the entire application.</p>
<p class="p_Normal">&nbsp;</p>
<h2 class="p_Heading2"><span class="f_Heading2">When NinjaTrader instantiates a NinjaScript object</span></h2>
<p class="p_Normal">There are two categories of instances instantiated by NinjaTrader:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>&quot;UI&quot; instances representing its default properties on various user interfaces</p><p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>The &quot;configured&quot; instance executing your custom instructions</p><p class="p_Normal">&nbsp;</p>
<p class="p_Normal">In both categories, <a href="onstatechange.html" class="topiclink">OnStateChange()</a> is called at least twice: &nbsp;once to <span style="font-weight: bold;">State.SetDefaults</span> acquiring various default property values, and then again to <span style="font-weight: bold;">State.Terminated</span> handling internal references cleanup.</p>
<p class="p_Normal">&nbsp;</p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table class="Note" >
<tr class="Note">
<td class="Note"><p class="p_Normal"><span style="font-weight: bold;">Note</span>: &nbsp;It is important to understand that previous major versions of NinjaTrader were not so diligent in running termination logic for UI instances and the current major NinjaTrader 8 version has been changed to help properly address related issues.</p>
</td>
</tr>
</table>
</div>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">To elaborate on that process, imagine the sequence of user events required to start an indicator on a chart:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">1.</span>User right clicks on a Chart and select &quot;<span class="f_Menu">Indicator</span>&quot;</p><p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">2.</span>User adds an Indicator from the <span style="font-weight: bold;">Available</span> list</p><p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">3.</span>User configures desired <span style="font-weight: bold;">Properties</span> and presses &quot;<span class="f_Menu">Apply</span>&quot; or &quot;<span class="f_Menu">OK</span>&quot;</p><p class="p_Normal">&nbsp;</p>
<p class="p_Normal">During this sequence, there are actually 3 instances of the same indicator created by NinjaTrader:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">1.</span>The instance displaying the <span style="font-weight: bold;">Name</span> property to the list of &quot;<span style="font-weight: bold;">Available</span>&quot; indicators (<span style="font-weight: bold;">Note</span>: this process involves creating an instance of <span style="font-style: italic;">all</span> indicators in order to build the complete list)</p><p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">2.</span>The instance displaying the individual <span style="font-weight: bold;">Name</span> and its default <span style="font-weight: bold;">Properties</span></p><p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">3.</span>The instance configured and executing on the chart</p><p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><img alt="indicator_dialog_state" width="636" height="562" style="margin:0;width:636px;height:562px;border:none" src="indicator_dialog_state.png"/></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">To visualize how each instance goes through its <span style="font-weight: bold;">States</span>, please consider the logic and flow chart below:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">1.</span>In order to display the indicator name in the list of <span style="font-weight: bold;">&quot;Available&quot;</span> indicators, the NinjaTrader core must find the <span style="font-weight: bold;">Name</span> of each installed indicator defined in their <span style="font-weight: bold;">SetDefaults</span>. &nbsp;This occurs simultaneously for <span style="font-style: italic;">every indicator installed on the system</span> in order to build the full list of available indicators.</p><p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">2.</span>The selected indicator is then <a href="clone.html" class="topiclink">cloned</a> and <span style="font-weight: bold;">SetDefaults</span> is called again in order to display the default properties to the &quot;<span style="font-weight: bold;">Properties</span>&quot; grid. &nbsp;This only occurs for the individual indicator.</p><p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">3.</span>After the user has set their desired property settings and press <span class="f_Menu">OK</span> or <span class="f_Menu">Apply</span>, the indicator is once again cloned and runs through its full state management. &nbsp;This only occurs for the indicator configured to execute on the chart.</p><h2 class="p_Heading2"><span class="f_Heading2">&nbsp;</span></h2>
<div style="text-align: left; text-indent: 0; padding: 0 0 0 0; margin: 0 0 0 0;"><table class="Warning" >
<tr class="Warning">
<td class="Warning"><p class="p_Normal"><span style="font-weight: bold;">Warning</span>: &nbsp;Since NinjaTrader is multi-threaded, it is possible the <span style="font-weight: bold;">OnStateChange()</span> logic will be operating on a different thread than your indicator instances. &nbsp;Due to this fact, if logic in your <span style="font-weight: bold;">OnStateChange()</span> method is thread sensitivity (e.g., dependent on UI threads vs Instrument threads) please make sure to read the section on <a href="multi-threading.html" class="topiclink">multi-threading considerations</a> and check for thread access in your <span style="font-weight: bold;">OnStateChange()</span> logic</p>
</td>
</tr>
</table>
</div>
<h2 class="p_Heading2"><span class="f_Heading2">&nbsp;</span></h2>
<h2 class="p_Heading2"><img alt="lifetime_of_ninjascript_indicator" width="635" height="562" style="margin:0;width:635px;height:562px;border:none" src="lifetime_of_ninjascript_indicator.png"/></h2>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">It is the 3rd &quot;configured&quot; instance you are concerned with developing, but you should also be aware of the &quot;UI&quot; instances which are triggered at various stages of  NinjaTrader.</p>
<p class="p_Normal">&nbsp;</p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table class="Note" >
<tr class="Note">
<td class="Note"><p class="p_Normal"> <span style="font-weight: bold;">Notes</span>: </p>
<p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">1.</span>The example above is written for an indicator, but the same concept of state management applies to every NinjaScript object type</p><p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">2.</span>The UI instances do not reach <span style="font-weight: bold;">State.Terminated</span> until the user closes out of the UI feature displaying the object</p><p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">3.</span>Since <a href="addon_development_overview.html" class="topiclink">AddOns</a> run in the background and are not dependent on UI elements, they will run through their <span style="font-weight: bold;">SetDefaults</span>/<span style="font-weight: bold;">Terminated</span> states after each NinjaScript compile and startup/shutdown of NinjaTrader.</p><p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">4.</span>The configured instance will also be cloned back to UI instances during various user actions (e.g, re-opening an indicator dialog to reconfigure settings, or user copying &amp; pasting the indicator to a new panel or chart). &nbsp;Therefore you should not assume that objects (such as ChartControl) will not be accessible in the UI instances.</p><p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">5.</span>In some extreme scenarios, you may need to execute custom logic before or after an object is cloned. &nbsp;Overriding the default behavior can be done via the virtual <a href="clone.html" class="topiclink">Clone()</a> method</p></td>
</tr>
</table>
</div>
<p class="p_Normal">&nbsp;</p>
<h2 class="p_Heading2"><span class="f_Heading2">What does this mean for me?</span></h2>
<p class="p_Normal">Since <span style="font-weight: bold;">OnStateChange()</span> can be called at various times throughout NinjaTrader, you should be diligent in handling each state and managing resources only when it is appropriate that your NinjaScript object was actually configured:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span><span style="font-weight: bold;">State.SetDefaults</span> should be kept as lean as possible to prevent logic from processing superfluously and causing problems unrelated to the configured instance. &nbsp;Only properties which need to be displayed on the UI should be set in this state.</p><p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>Resources should only be set up once an object has reached <span style="font-weight: bold;">State.Configure</span> or <span style="font-weight: bold;">State.DataLoaded</span> (see <a href="ninjascript_best_practices.html" class="topiclink">best practices</a> for more information) </p><p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span><span style="font-weight: bold;">State.Terminated</span> logic should be specific in when it resets a value or destroys a resource. &nbsp;Since the running instance can be cloned back to a UI instance, checking that a mutable property exists before accessing sometimes is not enough. &nbsp;You may need to consider adding a flag to help decide when a resource needs to be reset or destroyed. &nbsp;</p><h2 class="p_Heading2"><span class="f_Heading2">&nbsp;</span></h2>
<h2 class="p_Heading2"><span class="f_Heading2">Example</span></h2>
<p class="p_Normal">Let’s say your object was an indicator looking to add a custom toolbar element to the chart, and when the indicator is removed from the chart, you would want to make sure your toolbar elements are also properly removed. &nbsp;In the <a href="onstatechange.html" class="topiclink">OnStateChange()</a> handler you change could add the custom toolbar once the <span style="font-weight: bold;">State</span> has reached <span style="font-weight: bold;">State.Historical</span>, and remove the toolbar once the State has reached <span style="font-weight: bold;">State.Terminated</span>.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">To ensure that the remove logic only runs in instances that were actually configured, you can see we in the example below we also track that the toolbar needs a reset in <span style="font-weight: bold;">State.Terminated</span> state via a custom bool variable. &nbsp;In other words, the proper reset request comes from our configured instance and would be ignored if the <span style="font-weight: bold;">State.Terminated</span> is called from outside our object (i.e., a UI instance). This will prepare our object to properly handle both situations in which <span style="font-weight: bold;">State.Terminated</span> could be called in the NinjaTrader state management system.</p>
<h2 class="p_Heading2"><span class="f_Heading2">&nbsp;</span></h2>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table id="Code1" class="NSExample" >
<thead>
<tr class="NSExample">
<th class="NSExample" style="vertical-align:middle;"><p class="p_Normal"><img alt="ns" width="20" height="20" style="margin:0;width:20px;height:20px;border:none" src="ns.png"/> </p>
</th>
</tr>
</thead>
<tbody>
<tr class="NSExample">
<td class="NSExample"><p class="p_CodeExample"><span class="f_CodeExample" style="color: #008000;">// custom flag to help time termination logic</span><br />
<span class="f_CodeExample" style="color: #0000ff;">private</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">bool</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">toolBarNeedsReset</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">false</span><span class="f_CodeExample">;</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #0000ff;">protected</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">override</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">OnStateChange()</span><br />
<span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(State</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">==</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">State.SetDefaults)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp;  </span><span class="f_CodeExample">Name</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #800000;">&quot;State lifetime indicator&quot;</span><span class="f_CodeExample">;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample" style="color: #0000ff;">else</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(State</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">==</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">State.Historical)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// before indicator starts historical processing</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// add a custom tool bar using a custom method</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp;  </span><span class="f_CodeExample">AddToolBarButton();</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #008000;">// this is a pseudo-method for example purposes</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp;  </span><span class="f_CodeExample">toolBarNeedsReset</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">true</span><span class="f_CodeExample">;</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #008000;">// use a flag to track this logic was executed</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample" style="color: #0000ff;">else</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(State</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">==</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">State.Terminated)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// here we intend to remove the custom tool bar when the indicator shuts down</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(toolBarNeedsReset)</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #008000;">// flag is only true after actually added</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="f_CodeExample">RemoveToolBarButton();</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">}</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_Normal">&nbsp;</p>
<h2 class="p_Heading2"><span class="f_Heading2">Cloning NinjaScript</span></h2>
<p class="p_Normal">Clone is the operation of iterating over all public browsable properties on a NinjaScript object and duplicating the values over to a freshly generated instance. For the majority of NinjaScript with standard properties the clone process is transparent to you and you do not need to be concerned the the clone process. For those of you that want more control or will be utilizing complex properties then knowledge about clone is essential. Cloning is performed in 2 primary use cases:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">1.</span>Configuring an instance in an object dialog and then cloning the configured data to an actual NinjaScript instance applied for example to a Chart. (Configuration then Run) </p><p class="p_Normal" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">2.</span>When triggering 'Reload NinjaScript' or &quot;Reload All Historical Data'</p><p class="p_Normal">&nbsp;</p>
<p class="p_Normal">NinjaScript objects have a base clone method implemented which will iterating over all browsable properties and copy by value to the next instance. The rules follow the 'clone' rules described in the clone documentation located <a href="clone.html" class="topiclink">here</a> and described above. The default behavior will work in almost all cases except for when you have some complex custom property which needs specific clone behavior. In which case we allow the ability to override Clone() and specify your own behavior.</p>
<p class="p_Normal">&nbsp;</p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table class="Note" >
<tr class="Note">
<td class="Note"><p class="p_Normal"><span style="font-weight: bold;">Note</span>:  <span class="f_Notes">If you plan to utilize complex class properties on </span>NinjaScript<span class="f_Notes">, you can specify your own clone method. However when </span>NinjaScript<span class="f_Notes"> is compiled in </span>NinjaTrader<span class="f_Notes"> a new DLL holding the compiled IL code is 'hot-loaded' into </span>NinjaTrader<span class="f_Notes">. As a user or developer would try to reload </span>NinjaScript<span class="f_Notes"> or configure an existing </span>NinjaScript<span class="f_Notes"> object, any complex class will not resolve since the class will be residing in two different assemblies. This problem cannot be solved with custom clone method and workarounds for this are setting Browsable(false) attribute on that property so it is not cloned or putting the property it its own dedicated assembly. </span></p>
</td>
</tr>
</table>
</div>
<p class="p_Normal">&nbsp;</p>
<h2 class="p_Heading2"><span class="f_Heading2">Saving NinjaScript Properties to the Workspace via XML Serialization</span></h2>
<p class="p_Normal">XML Serialization comes into play when you have a set of properties and want those properties to persist the user saved workspace (or any templates that are user created). </p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">By default basic types such as int, string, bool will all serialize without issue, if you have a complex property you want its setting maintained on restore then you need to create a string serialized representation of that class. The technique is shown in this example post <a href="user_definable_color_inputs.html" class="topiclink">here</a> where we show how to serialize a color brush.</p>

        <!--ZOOMSTOP-->
      </div>
      <script type="text/javascript">
      
      var lastSlashPos = document.URL.lastIndexOf("https://ninjatrader.com/") > document.URL.lastIndexOf("\\") ? document.URL.lastIndexOf("https://ninjatrader.com/") : document.URL.lastIndexOf("\\");
      if (document.URL.substring(lastSlashPos + 1, lastSlashPos + 4).toLowerCase() != "~hh") {
      if (document.all) setTimeout(function() {
      nsrInit();
      }, 20);
      else nsrInit();
      }
      
      
      if ((!parent.hmNavigationFrame) && (parent.location) && (parent.location.href)) {
      $('.sync-toc').show();
      $('p.crumbs').hide();
      }
      
      
      </script>
      <div id="bump" style="height: 25px"></div>
    </body>
  
<!-- Mirrored from ninjatrader.com/support/helpGuides/nt8/understanding_the_lifecycle_of.htm by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 26 Jan 2023 19:55:44 GMT -->
</html>
