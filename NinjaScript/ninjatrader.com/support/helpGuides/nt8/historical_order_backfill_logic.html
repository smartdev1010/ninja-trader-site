<!DOCTYPE html>
<html>
  
<!-- Mirrored from ninjatrader.com/support/helpGuides/nt8/historical_order_backfill_logic.htm by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 26 Jan 2023 19:55:40 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <title>NinjaScript &gt; Educational Resources &gt; Historical Order Backfill Logic</title>
    <meta name="generator" content="Help &amp; Manual" />
    <meta name="keywords" content="" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link type="text/css" href="default.css" rel="stylesheet" />
    <link type="text/css" href="custom.css" rel="stylesheet">
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="nt_custom.js"></script>
    <style TYPE="text/css" media="screen">
    html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: #FFFFFF;
    line-height: 1.15
    }
    
    div#printheader {
    display: none
    }
    #idheader {
    width: 100%;
    height: auto;
    padding: 0;
    margin: 0
    }
    #idcontent {
    position: relative
    }
    #callout-table, #overview-table {
    display: block;
    position: relative;
    top: 0;
    left: 0
    }
    #callout-icon {
    display: block;
    position: absolute;
    top: -11px;
    left: -11px
    }
    #callout-icon-flag {
    display: block;
    position: absolute;
    top: -11px;
    left: -8px
    }
    #callout-table a {
    text-decoration: none;
    color: blue
    }
    #callout-table a:visited {
    text-decoration: none;
    color: blue
    }
    #overview-table a {
    text-decoration: none;
    color: black
    }
    #overview-table a:visited {
    text-decoration: none;
    color: black
    }
    #callout-table a:hover, #overview-table a:hover {
    text-decoration: underline
    }
    #switchtoggles {
    text-align: right;
    padding: 0 5px 0 0;
    font-size: 90%
    }
    p.help-url {
    margin: 20px 0 5px 0;
    text-align: center;
    font-size: 80%;
    text-decoration: none
    }
    .sync-toc {
    color: #ffffff;
    font-size: 8pt;
    font-weight: bold;
    display: none
    }
    .sync-toc a {
    color: #ffffff;
    text-decoration: none;
    font-weight: bold
    }
    .sync-toc a:visited {
    color: #ffffff
    }
    .sync-toc a:hover {
    text-decoration: underline
    }
    .p_ToggleHeading:active {
    box-shadow: 0px 0px 4px #9ecaed
    }                    
    .Needs {
      border-color: #008000 !important;
      background-color: #f3f9f4;
    }
    .Under {
      border-color: #ffcc00 !important;
      background-color: #fffdf6;
    }
    </style>
    <noscript>
    <style type="text/css">
    html, body { overflow: auto; }
    </style>
    </noscript>
    <style type="text/css" media="print">
    span.f_Heading1 { color: black; }
    #idheader, #printheader img { display:none; }
    #printheader { display: block; margin-top: 20px; }
    #idcontent { margin-top: 10px; position:relative }
    </style>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="helpman_settings.js"></script>
    <script type="text/javascript" src="helpman_topicinit.js"></script>
    <script type="text/javascript" src="nsh.js"></script>
    
    
    
  
   <script type="text/javascript">
     HMSyncTOC("NT%20HelpGuide%20English.html", "historical_order_backfill_logic.html");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
  <body>
    
    
    
    <div id="printheader"><p class="p_HeadingTopic"><span class="f_HeadingTopic">Historical Order Backfill Logic</span></p>
</div>
    <div id="idheader">
      <div id="idheaderbg">
        <table style="width:100%;border:none;margin:0px;background:#A41E22" cellspacing="0" cellpadding="0">
          <tr valign="bottom">
            <td align="left" valign="bottom" class="topichead">
              <p class="sync-toc">&lt;&lt; <a rel="nofollow" href="NT%20HelpGuide%20English3fa4.html?historical_order_backfill_logic.htm" target="_top">Click to Display Table of Contents</a> &gt;&gt;</p>
              <p class="crumbs" id="idnav"><b>Navigation:</b>&nbsp;
                
              <a href="ninjascript.html">NinjaScript</a> &gt; <a href="educational_resources.html">Educational Resources</a>&nbsp;&gt;</p>
              <p class="p_HeadingTopic"><span class="f_HeadingTopic">Historical Order Backfill Logic</span></p>

            </td>
            <td align="right" width="120" valign="middle" class="topichead" id="idnav">
              
              <a href="working_with_accounts.html"><img name="prev" src="leftArrow.png" border=0 alt="Previous page"></a>
              
              <a href="educational_resources.html"><img name=main src="upArrow.png" border=0 alt="Return to chapter overview"></a>
              <a href="multi-threading.html"><img name=next src="rightArrow.png" border=0 alt="Next page"></a>
              
            </td>
          </tr>
        </table>
<!-- PM review header         
        <div id="status" class="" style="margin-bottom: 0px; min-height: 25px;font-size: small; border-bottom: solid 3px;  padding: 5px;">
          <b></b>: <span id="explain"></span>
        </div>
-->        
        <!-- The following code displays Expand All/Collapse All links  below the header in topics containing toggles -->
        
      </div>
    </div>
    
    <div id="idcontent">
      <div id="innerdiv">
        <!-- Ask Internet Explorer 6.users to update their obsolete and dangerous browser -->
        <!--[if lt IE 7]><div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;'><a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0000_us.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." /></a></div><![endif]-->
        
        <!--ZOOMRESTART-->
        <h2 class="p_Heading2"><span class="f_Heading2">Understanding How Orders are backfilled for NinjaScript strategies</span></h2>
<p class="p_Normal">NinjaScript strategies use an algorithm to process order fills on historical data in two scenarios: when processing fills in the Strategy Analyzer, or when processing historical orders for a live running strategy. The algorithm fills historical orders using the same set of logic in both scenarios. Below is an outline of the logic used to determine the appropriate fill price for each historical order. When more than one order needs to be filled at once, the logic below will be ran for each individual order in succession.</p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<h2 class="p_Heading2"><span class="f_Heading2">General Outline</span></h2>
<p class="p_CodeExample">The steps involved in determining the appropriate fill price for an order are documented in their own sections below. The general, top-level outline of the logic can be broken into three steps:</p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">1.</span>Prepare to calculate fill prices</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">2.</span>Take three passes to calculate the appropriate fill price for each order which needs filled</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">3.</span>Fill the orders using the calculated fill price</p><p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<h2 class="p_Heading2"><span class="f_Heading2">Step 1 - Prepare to Calculate Fill Prices</span></h2>
<p class="p_CodeExample" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">1.</span>Determine all orders that need filled</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">2.</span>Determine the current bar being formed at the time</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">3.</span>Determine whether the current bar's first move was upward or downward</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">4.</span>Determine the strategy being run</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">5.</span>Determine the <a href="barsinprogress.html" class="topiclink">Bars In Progress</a> the strategy is currently processing</p><p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<h2 class="p_Heading2"><span class="f_Heading2">Step 2 - Take Three Passes To Determine Fill Price</span></h2>
<p class="p_CodeExample">The bulk of the backfill logic takes place in this step. Here orders are tested for their order types and prices, and are compared against current bar data to determine the appropriate fill prices per order type in different scenarios. </p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table class="Note" >
<tr class="Note">
<td class="Note"><p class="p_Normal"><span style="font-weight: bold;">Note</span>: Throughout these three passes, prices are temporarily stored in two variables: a &quot;next high price&quot; and a &quot;next low price.&quot; These are used to approximate the price that would be hit on the next tick, for the purpose of setting the fill price.</p>
</td>
</tr>
</table>
</div>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample">1. First Pass</p>
<p class="p_CodeExample" style="text-indent: 0; padding-left: 40px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">a.</span>If the current bar moved up first, save the current bar high price as the &quot;next high price,&quot; then save the current bar Open price as the &quot;next low price.&quot; &nbsp;</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 60px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">i.</span>If it moved down first, save the current bar Open price as the &quot;next high price,&quot; then save the current bar Low price as the &quot;next low price.&quot;</p><p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample" style="text-indent: 0; padding-left: 40px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">b.</span>if it's a Market Buy order, set the fill price to the lesser of the &quot;next high price&quot; or the bar Open</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 60px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">i.</span>If it's a Market Sell order, set the fill price to the greater of the &quot;next high price&quot; or the bar Open</p><p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample" style="text-indent: 0; padding-left: 40px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">c.</span>Ensure the strategy is currently processing the bar series on which the order resides, then:</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 60px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">i.</span>if the current order is Long, set the fill price to the lesser of the &quot;next high price&quot; or the current bar Open, taking slippage into account</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 80px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">1.</span>if it is Short, set the fill price to the greater of the saved &quot;next low price&quot; or the current bar Open, taking slippage into account</p><p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample" style="text-indent: 0; padding-left: 40px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">d.</span>Handle the special case of Limit orders with &quot;Fill Limit Orders on Touch&quot; enabled</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 60px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">i.</span>If the limit price has been touched, set the fill price to current bar Open</p><p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample" style="text-indent: 0; padding-left: 40px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">e.</span>Ensure the order would be filled without errors by comparing its stop and/or limit prices against each other and the current bar, then:</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 60px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">i.</span>For Limit orders, set the fill price to the current order's Limit price (however this is 'clamped' to happen inside the bar though)</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 60px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">ii.</span>For Stop Limit orders:</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 80px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">1.</span>if the order is Long, set the fill price to the greater of the existing fill price value or the current order's Limit price</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 80px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">2.</span>if it is Short, set the fill price to the lesser of the existing fill price value or the current order's Limit price</p><p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample">2. Second Pass</p>
<p class="p_CodeExample" style="text-indent: 0; padding-left: 40px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">a.</span>If the current bar moved up first, save the current bar High price as the &quot;next high price,&quot; then save the current bar Low price as the &quot;next low price.&quot; </p><p class="p_CodeExample" style="text-indent: 0; padding-left: 60px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">i.</span>If it moved down first, save the current bar Low price as the &quot;next high price,&quot; then save the current bar Low price as the &quot;next low price.&quot;</p><p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample" style="text-indent: 0; padding-left: 40px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">b.</span>if it's a Market Buy order and the bar moved up first, set the fill price to the lesser of the &quot;next high price&quot; or the bar High</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 60px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">i.</span>If the bar moved down first, set the fill price to the lesser of the &quot;next high price&quot; or the bar Low</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 40px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">c.</span>If it's a Market Sell order and the bar moved up first, set the fill price to the greater of the &quot;next high price&quot; or the bar High</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 60px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">i.</span>If the bar moved down first, set the fill price to the greater of the &quot;next high price&quot; or the bar Low</p><p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample" style="text-indent: 0; padding-left: 40px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">d.</span>Ensure the strategy is currently processing the bar series on which the order resides, then:</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 60px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">i.</span>if the current order is Long, set fill price to the lesser of the &quot;next high price&quot; or the current bar Open, taking slippage into account</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 80px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">1.</span>if it is Short, set the fill price to the greater of the &quot;next low price&quot; or the current bar Open, taking slippage into account</p><p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample" style="text-indent: 0; padding-left: 40px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">e.</span>Handle the special case of Limit orders with &quot;Fill Limit on Touch&quot; enabled</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 60px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">i.</span>If the limit price has been touched, set the fill price to current bar Open</p><p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample" style="text-indent: 0; padding-left: 40px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">f.</span>Ensure the order would be filled without errors by comparing its stop and/or limit prices against each other and the current bar, then:</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 60px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">i.</span>For Limit orders, set the fill price to the current order's Limit price (however this is 'clamped' to happen inside the bar though)</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 60px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">ii.</span>For Stop Limit orders:</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 80px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">1.</span>if the order is Long, set the fill price to the greater of the existing fill price value or the current order's Limit price</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 80px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">2.</span>if it is Short, set the fill price to the lesser of the existing fill price or the current order's Limit price</p><p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample">3. Third Pass</p>
<p class="p_CodeExample" style="text-indent: 0; padding-left: 40px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">a.</span>If the current bar moved up first, save the current bar Close price as the &quot;next high price,&quot; then save the current bar Low price as the &quot;next low price.&quot; </p><p class="p_CodeExample" style="text-indent: 0; padding-left: 60px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">i.</span>If it moved down first, save the current bar High price as the &quot;next high price,&quot; then save the current bar Close price as the &quot;next low price.&quot;</p><p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample" style="text-indent: 0; padding-left: 40px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">b.</span>If it's a Market Buy order and the bar moved up first, set the fill price to the lesser of the &quot;next high price&quot; or the bar Low</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 60px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">i.</span>If the bar moved down first, set the fill price to the lesser of the &quot;next high price&quot; or the bar High</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 40px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">c.</span>If it's a Market Sell order and the bar moved up first, set the fill price to the greater of the &quot;next high price&quot; or the bar Low</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 60px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">i.</span>If the bar moved down first, set the fill price to the greater of the &quot;next high price&quot; or the bar High</p><p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample" style="text-indent: 0; padding-left: 40px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">d.</span>Ensure the strategy is currently processing the bar series on which the order resides, then:</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 60px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">i.</span>if the current order is Long, set the fill price to the lesser of the &quot;next high price&quot; or the current bar Open, taking slippage into account</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 80px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">1.</span>if it is Short, set the fill price to the greater of the &quot;next low price&quot; or the current bar Open, taking slippage into account</p><p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample" style="text-indent: 0; padding-left: 40px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">e.</span>Handle the special case of Limit orders with &quot;Fill Limit on Touch&quot; enabled</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 60px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">i.</span>If the limit price has been touched, set the fill price to current bar Open</p><p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample" style="text-indent: 0; padding-left: 40px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">f.</span>Ensure the order would be filled without errors by comparing its stop and/or limit prices against each other and the current bar, then:</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 60px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">i.</span>For Limit orders, set the fill price to the current order's Limit price (however this is 'clamped' to happen inside the bar though)</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 60px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">ii.</span>For Stop Limit orders:</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 80px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">1.</span>if the order is Long, set the fill price to the greater of the existing fill price or the current order's Limit price</p><p class="p_CodeExample" style="text-indent: 0; padding-left: 80px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">2.</span>if the order is Short, set the fill price to the lesser of the existing fill price or the current order's Limit price</p><p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<h2 class="p_Heading2"><span class="f_Heading2">Step 3 - Fill the Order</span></h2>
<h2 class="p_Heading2">Each order is filled using the final fill price calculated for that particular order. If an order cannot be filled at this step, no further attempts will be made. Possible scenarios which would cause an order not to be filled at this stage include switching from State.Historical to State.Realtime when the strategy is currently waiting for a flat position before submitting orders, or a connectivity issue.</h2>
<h2 class="p_Heading2"><span class="f_Heading2">&nbsp;</span></h2>
<p class="p_Heading2" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">1.</span>If the order is an entry, first temporarily clear all Entry Signals and pending orders from internally held collections of pending Entry Signals and orders</p><h2 class="p_Heading2"><span class="f_Heading2">&nbsp;</span></h2>
<p class="p_Heading2" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">2.</span>If its an exit, first determine the quantity that needs to be filled</p><p class="p_Heading2" style="text-indent: 0; padding-left: 40px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">a.</span>If the position being closed has not been partially closed already, use the full order quantity</p><p class="p_Heading2" style="text-indent: 0; padding-left: 40px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">b.</span>If the position has already been partially closed by other orders, set the order quantity to the remaining position quantity</p><h2 class="p_Heading2"><span class="f_Heading2">&nbsp;</span></h2>
<p class="p_Heading2" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">3.</span>Determine whether the strategy needs to wait until flat before filling the order</p><p class="p_Heading2" style="text-indent: 0; padding-left: 40px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">a.</span>This would apply if an exit order is being processed in real time, attempting to exit a position that was simulated on historical data</p><h2 class="p_Heading2"><span class="f_Heading2">&nbsp;</span></h2>
<p class="p_Heading2" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">4.</span>Create and parameterize a new Execution object (set Account, Commission, Instrument, Name, etc.)</p><h2 class="p_Heading2"><span class="f_Heading2">&nbsp;</span></h2>
<p class="p_Heading2" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">5.</span>Set properties of the Order object being analyzed</p><p class="p_Heading2" style="text-indent: 0; padding-left: 40px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">a.</span>AvgFillPrice, Filled (quantity), OrderState (set to OrderState.Filled)</p><h2 class="p_Heading2"><span class="f_Heading2">&nbsp;</span></h2>
<p class="p_Heading2" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">6.</span>Add the new Execution to the Executions collection</p><h2 class="p_Heading2"><span class="f_Heading2">&nbsp;</span></h2>
<p class="p_Heading2" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">7.</span>Add the order to the Orders collection</p><h2 class="p_Heading2"><span class="f_Heading2">&nbsp;</span></h2>
<p class="p_Heading2" style="text-indent: 0; padding-left: 20px; margin-left: 0;"><span class="f_Normal" style="display:inline-block;width:20px;margin-left:-20px">8.</span>Fill the order</p>
        <!--ZOOMSTOP-->
      </div>
      <script type="text/javascript">
      
      var lastSlashPos = document.URL.lastIndexOf("https://ninjatrader.com/") > document.URL.lastIndexOf("\\") ? document.URL.lastIndexOf("https://ninjatrader.com/") : document.URL.lastIndexOf("\\");
      if (document.URL.substring(lastSlashPos + 1, lastSlashPos + 4).toLowerCase() != "~hh") {
      if (document.all) setTimeout(function() {
      nsrInit();
      }, 20);
      else nsrInit();
      }
      
      
      if ((!parent.hmNavigationFrame) && (parent.location) && (parent.location.href)) {
      $('.sync-toc').show();
      $('p.crumbs').hide();
      }
      
      
      </script>
      <div id="bump" style="height: 25px"></div>
    </body>
  
<!-- Mirrored from ninjatrader.com/support/helpGuides/nt8/historical_order_backfill_logic.htm by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 26 Jan 2023 19:55:40 GMT -->
</html>
