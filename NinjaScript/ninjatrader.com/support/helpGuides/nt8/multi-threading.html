<!DOCTYPE html>
<html>
  
<!-- Mirrored from ninjatrader.com/support/helpGuides/nt8/multi-threading.htm by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 26 Jan 2023 19:55:40 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <title>NinjaScript &gt; Educational Resources &gt; Multi-Threading Consideration for NinjaScript</title>
    <meta name="generator" content="Help &amp; Manual" />
    <meta name="keywords" content="" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <link type="text/css" href="default.css" rel="stylesheet" />
    <link type="text/css" href="custom.css" rel="stylesheet">
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="nt_custom.js"></script>
    <style TYPE="text/css" media="screen">
    html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    background: #FFFFFF;
    line-height: 1.15
    }
    
    div#printheader {
    display: none
    }
    #idheader {
    width: 100%;
    height: auto;
    padding: 0;
    margin: 0
    }
    #idcontent {
    position: relative
    }
    #callout-table, #overview-table {
    display: block;
    position: relative;
    top: 0;
    left: 0
    }
    #callout-icon {
    display: block;
    position: absolute;
    top: -11px;
    left: -11px
    }
    #callout-icon-flag {
    display: block;
    position: absolute;
    top: -11px;
    left: -8px
    }
    #callout-table a {
    text-decoration: none;
    color: blue
    }
    #callout-table a:visited {
    text-decoration: none;
    color: blue
    }
    #overview-table a {
    text-decoration: none;
    color: black
    }
    #overview-table a:visited {
    text-decoration: none;
    color: black
    }
    #callout-table a:hover, #overview-table a:hover {
    text-decoration: underline
    }
    #switchtoggles {
    text-align: right;
    padding: 0 5px 0 0;
    font-size: 90%
    }
    p.help-url {
    margin: 20px 0 5px 0;
    text-align: center;
    font-size: 80%;
    text-decoration: none
    }
    .sync-toc {
    color: #ffffff;
    font-size: 8pt;
    font-weight: bold;
    display: none
    }
    .sync-toc a {
    color: #ffffff;
    text-decoration: none;
    font-weight: bold
    }
    .sync-toc a:visited {
    color: #ffffff
    }
    .sync-toc a:hover {
    text-decoration: underline
    }
    .p_ToggleHeading:active {
    box-shadow: 0px 0px 4px #9ecaed
    }                    
    .Needs {
      border-color: #008000 !important;
      background-color: #f3f9f4;
    }
    .Under {
      border-color: #ffcc00 !important;
      background-color: #fffdf6;
    }
    </style>
    <noscript>
    <style type="text/css">
    html, body { overflow: auto; }
    </style>
    </noscript>
    <style type="text/css" media="print">
    span.f_Heading1 { color: black; }
    #idheader, #printheader img { display:none; }
    #printheader { display: block; margin-top: 20px; }
    #idcontent { margin-top: 10px; position:relative }
    </style>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="helpman_settings.js"></script>
    <script type="text/javascript" src="helpman_topicinit.js"></script>
    <script type="text/javascript" src="nsh.js"></script>
    
    
    
  
   <script type="text/javascript">
     HMSyncTOC("NT%20HelpGuide%20English.html", "multi-threading.html");
   </script>
   <script type="text/javascript" src="highlight.js"></script>
   <script type="text/javascript">
     $(document).ready(function(){highlight();});
   </script>
</head>
  <body>
    
    
    
    <div id="printheader"><p class="p_HeadingTopic"><span class="f_HeadingTopic">Multi-Threading Consideration for NinjaScript</span></p>
</div>
    <div id="idheader">
      <div id="idheaderbg">
        <table style="width:100%;border:none;margin:0px;background:#A41E22" cellspacing="0" cellpadding="0">
          <tr valign="bottom">
            <td align="left" valign="bottom" class="topichead">
              <p class="sync-toc">&lt;&lt; <a rel="nofollow" href="NT%20HelpGuide%20English023f.html?multi-threading.htm" target="_top">Click to Display Table of Contents</a> &gt;&gt;</p>
              <p class="crumbs" id="idnav"><b>Navigation:</b>&nbsp;
                
              <a href="ninjascript.html">NinjaScript</a> &gt; <a href="educational_resources.html">Educational Resources</a>&nbsp;&gt;</p>
              <p class="p_HeadingTopic"><span class="f_HeadingTopic">Multi-Threading Consideration for NinjaScript</span></p>

            </td>
            <td align="right" width="120" valign="middle" class="topichead" id="idnav">
              
              <a href="historical_order_backfill_logic.html"><img name="prev" src="leftArrow.png" border=0 alt="Previous page"></a>
              
              <a href="educational_resources.html"><img name=main src="upArrow.png" border=0 alt="Return to chapter overview"></a>
              <a href="multi-time_frame__instruments.html"><img name=next src="rightArrow.png" border=0 alt="Next page"></a>
              
            </td>
          </tr>
        </table>
<!-- PM review header         
        <div id="status" class="" style="margin-bottom: 0px; min-height: 25px;font-size: small; border-bottom: solid 3px;  padding: 5px;">
          <b></b>: <span id="explain"></span>
        </div>
-->        
        <!-- The following code displays Expand All/Collapse All links  below the header in topics containing toggles -->
        
      </div>
    </div>
    
    <div id="idcontent">
      <div id="innerdiv">
        <!-- Ask Internet Explorer 6.users to update their obsolete and dangerous browser -->
        <!--[if lt IE 7]><div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;'><a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode"><img src="http://storage.ie6countdown.com/assets/100/images/banners/warning_bar_0000_us.jpg" border="0" height="42" width="820" alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today." /></a></div><![endif]-->
        
        <!--ZOOMRESTART-->
        <h2 class="p_Heading2"><span class="f_Heading2">Multi-Threading Overview</span></h2>
<p class="p_Normal">With the introduction of multi-threading in NinjaTrader special considerations should be made when programming your NinjaScript objects. Multi-threading basically allows NinjaTrader to take advantage of multi-core CPUs commonplace in modern computing to do multiple tasks at the same time. &nbsp;While this has many advantages for multi-tasking, it can cause new types of issues you may have not needed to consider before. &nbsp;This page was designed to serve as a high-level overview of some of the most common scenarios that can arise due to multi-threading, but should not be considered an exhaustive list. &nbsp;</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><span class="f_Heading2">Using A Dispatcher</span></p>
<p class="p_Normal">Depending on your CPU configuration, the NinjaTrader application will usually consist of multiple main UI threads, where various features like Charts or NinjaScript objects run, along with a number of background worker threads where events such as market data updates will be distributed throughout the product. &nbsp;In principle, an object can only access information related to objects that exist on the same thread. &nbsp;It is possible (and quite likely), that the thread which a NinjaScript object is running will not be the same thread as the event which is calling the object. &nbsp;In cases where you need to access objects on the UI from a NinjaScript objects calling event thread, a <a href="https://msdn.microsoft.com/en-us/library/system.windows.threading.dispatcher(v=vs.110).aspx" target="_blank" onclick="return HMTrackTopiclink(this);" class="weblink">dispatcher</a> can be used.</p>
<p class="p_Normal">&nbsp;</p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table class="Note" >
<tr class="Note">
<td class="Note"><p class="p_Normal"><span style="font-weight: bold;">Note</span>: &nbsp;As a best practice, you should always make sure to use <a href="https://msdn.microsoft.com/en-us/library/system.windows.threading.dispatcher.invokeasync(v=vs.110).aspx" target="_blank" onclick="return HMTrackTopiclink(this);" class="weblink">Dispatcher.InvokeAsync() </a>to ensure your action is done asynchronously to any internal NinjaTrader actions. &nbsp;Calling the synchronous <span style="font-weight: bold;">Dispatcher.Invoke()</span> method can potentially result in a deadlock scenarios as your script is loaded.</p>
</td>
</tr>
</table>
</div>
<p class="p_Normal">&nbsp;</p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table id="Code1" class="NSExample" >
<thead>
<tr class="NSExample">
<th class="NSExample" style="vertical-align:middle;"><p class="p_ExampleText"><img alt="ns" width="20" height="20" style="margin:0;width:20px;height:20px;border:none" src="ns.png"/><span class="f_ExampleText"> </span></p>
</th>
</tr>
</thead>
<tbody>
<tr class="NSExample">
<td class="NSExample"><p class="p_CodeExample"><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(State</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">==</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">State.Historical)</span><br />
<span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(ChartControl</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">!=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">null</span><span class="f_CodeExample">)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// add some text to the UserControlCollection through the ChartControls dispatcher</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp;  </span><span class="f_CodeExample">ChartControl.Dispatcher.InvokeAsync(</span><span class="f_CodeExample" style="color: #0000ff;">new</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">Action(()</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=&gt;</span><span class="f_CodeExample" style="color: #ffffff;">  </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="f_CodeExample">UserControlCollection.Add(</span><span class="f_CodeExample" style="color: #0000ff;">new</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">System.Windows.Controls.TextBlock</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">Text</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #800000;">&quot;\nAdded by the ChartControl Dispatcher.&quot;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="f_CodeExample">});</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp;  </span><span class="f_CodeExample">}));</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">}</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">&nbsp;</p>
<h2 class="p_Heading2"><span class="f_Heading2">Thread Access</span></h2>
<p class="p_Normal">Since market data is distributed across the entire application by a randomly assigned UI thread, there is no guarantee that your object will be running on the same event thread that is calling the object. Therefore it is recommend that you call <a href="https://msdn.microsoft.com/en-us/library/system.windows.threading.dispatcher.checkaccess(v=vs.110).aspx" target="_blank" onclick="return HMTrackTopiclink(this);" class="weblink">Dispatcher.CheckAccess() </a>in order to test if you truly need to dispatch the requested action.</p>
<p class="p_Normal">&nbsp;</p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table id="Code1" class="NSExample" >
<thead>
<tr class="NSExample">
<th class="NSExample" style="vertical-align:middle;"><p class="p_ExampleText"><img alt="ns" width="20" height="20" style="margin:0;width:20px;height:20px;border:none" src="ns.png"/><span class="f_ExampleText"> </span></p>
</th>
</tr>
</thead>
<tbody>
<tr class="NSExample">
<td class="NSExample"><p class="p_CodeExample"><span class="f_CodeExample" style="color: #008000;">// check if the current object is already on the calling thread</span><br />
<span class="f_CodeExample" style="color: #0000ff;">if</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(Dispatcher.CheckAccess())</span><br />
<span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// execute action directly</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample">action(args);</span><br />
<span class="f_CodeExample">}</span><br />
<span class="f_CodeExample" style="color: #008000;">// otherwise run the action from the thread that created the object</span><br />
<span class="f_CodeExample" style="color: #0000ff;">else</span><br />
<span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample" style="color: #008000;">// dispatch action to calling thread</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; </span><span class="f_CodeExample">Dispatcher.InvokeAsync(action,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">args);</span><br />
<span class="f_CodeExample">}</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">&nbsp;</p>
<h2 class="p_Heading2"><span class="f_Heading2">Cross Thread Exceptions</span></h2>
<p class="p_Normal">When accessing objects included on the UI, you may receive the following error if you attempt to access a certain property/method from the wrong thread:</p>
<p class="p_ExampleText"><span class="f_ExampleText">&nbsp;</span></p>
<p class="p_ExampleText"><span class="f_ExampleText">&quot;Error on calling 'OnBarUpdate' method on bar 0: You are accessing an object which resides on another thread. I.E. creating your own Brush without calling .Freeze(), or trying to access a UI control from the wrong thread without using a Dispatcher&quot;</span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">This error can be avoided by invoking the <span style="font-weight: bold;">Dispatcher</span> used on the appropriate UI thread.</p>
<p class="p_Normal">&nbsp;</p>
<h2 class="p_Heading2"><span class="f_Heading2">Access Violation Exception</span></h2>
<p class="p_Normal">Should you be using custom resources like text files, static members, etc. it is important to protect your resources from concurrent access. If NinjaTrader tried to use the resource at the same time you would run into errors similar to this one:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal"><span style="font-weight: bold; color: #808080;">8/20/2010 12:14:29 PM|3|128|Error on calling 'OnBarUpdate' method for strategy 'SampleStrategy/1740b50bfe5d4bd896b0533725622400': The process cannot access the file 'c:\sample.txt' because it is being used by another process.</span></p>
<p class="p_Normal">&nbsp;</p>
<div style="text-align: left; text-indent: 0; line-height: 1.38; padding: 0 0 0 0; margin: 0 0 0 0;"><table id="Code1" class="NSExample" >
<thead>
<tr class="NSExample">
<th class="NSExample" style="vertical-align:middle;"><p class="p_ExampleText"><img alt="ns" width="20" height="20" style="margin:0;width:20px;height:20px;border:none" src="ns.png"/><span class="f_ExampleText"> </span></p>
</th>
</tr>
</thead>
<tbody>
<tr class="NSExample">
<td class="NSExample"><p class="p_CodeExample"><span class="f_CodeExample" style="color: #0000ff;">private</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">object</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">lockObj</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">new</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">object</span><span class="f_CodeExample">();</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #0000ff;">private</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">void</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">WriteFile()</span><br />
<span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// lock a generic object to ensure only one thread is accessing the following code block at a time</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">lock</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(lockObj)</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp;  </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">string</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">filePath</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">@</span><span class="f_CodeExample" style="color: #800000;">&quot;C:\sample.txt&quot;</span><span class="f_CodeExample">;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #0000ff;">using</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">(System.IO.FileStream</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">file</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">=</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample" style="color: #0000ff;">new</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">System.IO.FileStream(filePath,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">FileMode.Append,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">FileAccess.Write,</span><span class="f_CodeExample" style="color: #ffffff;"> </span><span class="f_CodeExample">FileShare.None))</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">{</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// write something to the file...</span><br />
<span class="f_CodeExample" style="color: #008000;">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// be sure to flush the buffer so everything is written to the file.</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">file.Flush();</span><br />
<span class="f_CodeExample">&nbsp;</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// The &quot;using&quot; block implicitly closes the FileStream object,</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample" style="color: #008000;">// giving other threads access to the file</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp; &nbsp; &nbsp;  </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample" style="color: #ffffff;"> &nbsp;  </span><span class="f_CodeExample">}</span><br />
<span class="f_CodeExample">}</span></p>
</td>
</tr>
</tbody>
</table>
</div>
<p class="p_CodeExample"><span class="f_CodeExample">&nbsp;</span></p>
<p class="p_Normal"><span class="f_Heading2">Multi-threaded consideration for Order, Execution and Position objects </span></p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">These considerations apply to the <a href="onorderupdate.html" class="topiclink">OnOrderUpdate()</a>, <a href="onexecutionupdate.html" class="topiclink">OnExecutionUpdate()</a> and <a href="onpositionupdate.html" class="topiclink">OnPositionUpdate()</a> handlers, where both the actual 'core' objects are passed by reference and updating method value parameters are provided. Examplary the <a href="onorderupdate.html" class="topiclink">OnOrderUpdate()</a> is discussed in below.</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span><a href="onorderupdate.html" class="topiclink">OnOrderUpdate()</a> method guarantees that you will see each order state change in sequence </p><p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>The &quot;order&quot; method parameter represents the core order object updated by NinjaTrader</p><p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>The supplementary method parameters provide an updating value representing each order change in sequence. &nbsp;Think of this as the relevant information on the order at the time the state changed.</p><p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>Since the &quot;order&quot; &nbsp;method parameter represents the current order object state, it is possible for the updating values of that object to be out of sync with the correspond method parameters during a particular order update event.</p><p class="p_Normal">&nbsp;</p>
<p class="p_Normal">As an example, the NinjaTrader core may have received &quot;Working&quot; and then &quot;PartFilled&quot; order state change events back from the broker API on thread &quot;B&quot;. At some point in time (milliseconds later) the NinjaTrader core will take these events and trigger the OnOrderUpdate() method in the strategy on thread &quot;A&quot;. Thus, when the strategy receives the first &quot;Working&quot; state for an order, the <span style="font-weight: bold;">orderState</span> method parameter will reflect the &quot;Working&quot; state although the actual <span style="font-weight: bold;">order.OrderState</span> is really in a state of &quot;Part Filled&quot;. &nbsp;You would see that current value truly reflected in the core Order object method parameter or any order objects returned in any of the order methods such as EnterLong(). Of course, the OnOrderUpdate() method parameters will eventually receive the event for &quot;PartFilled&quot; state in the sequence the events were received. </p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal">Considering the concept above, if you are unsure if you should be using the core order object value vs the updating method parameter value value, ask your self if you are truly looking for the <span style="font-style: italic;">most current order state</span>, or the <span style="font-style: italic;">sequence of order states</span>:</p>
<p class="p_Normal">&nbsp;</p>
<p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>For the most current order state, use the core &quot;order&quot; object property (e.g., order.OrderState, order.LimitPrice, order.StopPrice, etc)</p><p class="p_Normal" style="text-indent: 0; padding-left: 13px; margin-left: 0;"><span class="f_Normal" style="font-family: Arial,'Lucida Sans Unicode','Lucida Grande','Lucida Sans';display:inline-block;width:13px;margin-left:-13px">&#8226;</span>For the sequence of order states, use the updating method parameter value (e.g., orderState, limitPrice, stopPrice, etc)</p>
        <!--ZOOMSTOP-->
      </div>
      <script type="text/javascript">
      
      var lastSlashPos = document.URL.lastIndexOf("https://ninjatrader.com/") > document.URL.lastIndexOf("\\") ? document.URL.lastIndexOf("https://ninjatrader.com/") : document.URL.lastIndexOf("\\");
      if (document.URL.substring(lastSlashPos + 1, lastSlashPos + 4).toLowerCase() != "~hh") {
      if (document.all) setTimeout(function() {
      nsrInit();
      }, 20);
      else nsrInit();
      }
      
      
      if ((!parent.hmNavigationFrame) && (parent.location) && (parent.location.href)) {
      $('.sync-toc').show();
      $('p.crumbs').hide();
      }
      
      
      </script>
      <div id="bump" style="height: 25px"></div>
    </body>
  
<!-- Mirrored from ninjatrader.com/support/helpGuides/nt8/multi-threading.htm by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 26 Jan 2023 19:55:40 GMT -->
</html>
